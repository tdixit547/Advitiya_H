{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/app/%5Bslug%5D/page.tsx"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Public Hub Page\n// Dynamic route: /[slug]\n// ============================================\n\nimport { headers } from 'next/headers';\nimport { notFound } from 'next/navigation';\nimport { Metadata } from 'next';\nimport { Hub, Link, LinkWithRules } from '@/types';\nimport { evaluateRules } from '@/lib/rule-engine';\nimport { getVisitorContext } from '@/lib/visitor-context';\nimport { getLinksWithRules as fetchLinksFromStorage } from '@/lib/storage';\nimport LinkButton from '@/components/LinkButton';\n\n// Demo data for initial testing (replace with DB queries later)\nconst DEMO_HUB: Hub = {\n  id: 1,\n  user_id: 1,\n  slug: 'demo',\n  title: 'Demo Hub',\n  bio: 'Welcome to my Smart Link Hub! ðŸš€',\n  avatar_url: null,\n  theme_config: {\n    bg: '#000000',\n    accent: '#00FF00',\n    textColor: '#FFFFFF',\n  },\n  is_active: true,\n  created_at: new Date(),\n  updated_at: new Date(),\n};\n\ninterface PageProps {\n  params: Promise<{ slug: string }>;\n}\n\n// Generate metadata for SEO\nexport async function generateMetadata({\n  params,\n}: PageProps): Promise<Metadata> {\n  const { slug } = await params;\n  const hub = await getHub(slug);\n\n  if (!hub) {\n    return {\n      title: 'Hub Not Found',\n    };\n  }\n\n  return {\n    title: `${hub.title} | Smart Link Hub`,\n    description: hub.bio || `Check out ${hub.title}'s links`,\n    openGraph: {\n      title: hub.title,\n      description: hub.bio || undefined,\n      type: 'profile',\n    },\n  };\n}\n\n// Fetch hub data (demo implementation)\nasync function getHub(slug: string): Promise<Hub | null> {\n  // Allow accessing the demo hub via 'demo' or '1'\n  if (slug === 'demo' || slug === '1') {\n    return DEMO_HUB;\n  }\n  return null;\n}\n\n// Fetch links with rules (using file storage)\nasync function getLinksWithRules(hubId: number): Promise<LinkWithRules[]> {\n  try {\n    const allLinks = await fetchLinksFromStorage();\n    return allLinks\n      .filter((l) => l.hub_id === hubId)\n      .sort((a, b) => b.priority - a.priority);\n  } catch (error) {\n    console.error('Error fetching links:', error);\n    return [];\n  }\n}\n\n// Track page view (demo implementation)\nasync function trackPageView(\n  hubId: number,\n  visitorCountry: string | null,\n  visitorDevice: string,\n  userAgent: string,\n  referrer: string | null\n): Promise<void> {\n  // TODO: Replace with actual database insert\n  // console.log('Page View:', { hubId, visitorCountry, ... }); \n}\n\nexport default async function HubPage({ params }: PageProps) {\n  const { slug } = await params;\n\n  // Fetch hub data\n  const hub = await getHub(slug);\n  if (!hub) {\n    notFound();\n  }\n\n  // Get visitor context from headers\n  const headersList = await headers();\n  const context = await getVisitorContext(headersList);\n\n  // Fetch links with their rules\n  const linksWithRules = await getLinksWithRules(hub.id);\n\n  // Apply smart rules to filter links\n  const filteredLinks = evaluateRules(linksWithRules, context);\n\n  // Track page view (async, don't wait)\n  trackPageView(\n    hub.id,\n    context.country,\n    context.device,\n    context.userAgent,\n    context.referrer\n  );\n\n  const { bg, accent, textColor } = hub.theme_config;\n\n  return (\n    <main\n      className=\"min-h-screen flex flex-col items-center px-4 py-12\"\n      style={{ backgroundColor: bg, color: textColor }}\n    >\n      {/* Profile Section */}\n      <div className=\"text-center mb-8 animate-fade-in\">\n        {/* Avatar */}\n        <div\n          className=\"w-24 h-24 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl font-bold\"\n          style={{\n            backgroundColor: `${accent}20`,\n            border: `3px solid ${accent}`,\n            boxShadow: `0 0 20px ${accent}40`,\n          }}\n        >\n          {hub.title.charAt(0).toUpperCase()}\n        </div>\n\n        {/* Title */}\n        <h1\n          className=\"text-2xl font-bold mb-2\"\n          style={{ color: accent }}\n        >\n          {hub.title}\n        </h1>\n\n        {/* Bio */}\n        {hub.bio && (\n          <p className=\"text-gray-400 max-w-md mx-auto\">{hub.bio}</p>\n        )}\n      </div>\n\n      {/* Links Section */}\n      <div className=\"w-full max-w-md space-y-4\">\n        {filteredLinks.length > 0 ? (\n          filteredLinks.map((link, index) => (\n            <LinkButton\n              key={link.id}\n              link={link}\n              accent={accent}\n              index={index}\n            />\n          ))\n        ) : (\n          <p className=\"text-center text-gray-500\">No links available</p>\n        )}\n      </div>\n\n      {/* Footer */}\n      <footer className=\"mt-12 text-center text-gray-600 text-sm\">\n        <p>\n          Powered by{' '}\n          <span style={{ color: accent }} className=\"font-semibold\">\n            Smart Link Hub\n          </span>\n        </p>\n      </footer>\n\n      {/* Debug info (development only) */}\n      {process.env.NODE_ENV === 'development' && (\n        <div className=\"mt-8 p-4 rounded-lg text-xs font-mono\" style={{ backgroundColor: '#111' }}>\n          <p className=\"text-gray-500 mb-2\">Debug Info:</p>\n          <p>Device: {context.device}</p>\n          <p>OS: {context.os}</p>\n          <p>Country: {context.country || 'Unknown'}</p>\n          <p>Hour: {context.currentHour}</p>\n          <p>Day: {context.currentDay}</p>\n          <p>Total Links: {linksWithRules.length}</p>\n          <p>Filtered Links: {filteredLinks.length}</p>\n        </div>\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}