{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/lib/rule-engine.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Rule Engine\n// The core \"Smart\" routing logic\n// ============================================\n\nimport {\n  Link,\n  LinkWithRules,\n  LinkRule,\n  VisitorContext,\n  TimeConditions,\n  DeviceConditions,\n  LocationConditions,\n} from '@/types';\n\n/**\n * Evaluates all smart rules for a list of links based on visitor context.\n * Returns filtered and sorted links that should be displayed.\n */\nexport function evaluateRules(\n  links: LinkWithRules[],\n  context: VisitorContext\n): Link[] {\n  // Filter only active links\n  const activeLinks = links.filter((link) => link.is_active);\n\n  // Apply rules to each link\n  const filteredLinks = activeLinks.filter((link) => {\n    return shouldShowLink(link, context);\n  });\n\n  // Sort by priority (higher first) and click_count (performance-based)\n  const sortedLinks = filteredLinks.sort((a, b) => {\n    // Primary: priority (descending)\n    if (b.priority !== a.priority) {\n      return b.priority - a.priority;\n    }\n    // Secondary: click_count for performance-based sorting (descending)\n    return b.click_count - a.click_count;\n  });\n\n  // Return links without the rules property (clean response)\n  return sortedLinks.map(({ rules, ...link }) => link);\n}\n\n/**\n * Determines if a link should be shown based on its rules and visitor context.\n */\nfunction shouldShowLink(link: LinkWithRules, context: VisitorContext): boolean {\n  // If no rules, always show\n  if (!link.rules || link.rules.length === 0) {\n    return true;\n  }\n\n  // Get only active rules\n  const activeRules = link.rules.filter((rule) => rule.is_active);\n\n  // If no active rules, always show\n  if (activeRules.length === 0) {\n    return true;\n  }\n\n  // Check each rule - if ANY rule says HIDE, hide the link\n  // If a SHOW rule's condition is NOT met, also hide the link\n  for (const rule of activeRules) {\n    const conditionMet = evaluateRule(rule, context);\n\n    if (rule.action === 'SHOW' && !conditionMet) {\n      // SHOW rule condition not met = hide\n      return false;\n    }\n\n    if (rule.action === 'HIDE' && conditionMet) {\n      // HIDE rule condition met = hide\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Evaluates a single rule against the visitor context.\n * Returns true if the condition is satisfied.\n */\nfunction evaluateRule(rule: LinkRule, context: VisitorContext): boolean {\n  switch (rule.rule_type) {\n    case 'TIME':\n      return evaluateTimeRule(rule.conditions as TimeConditions, context);\n    case 'DEVICE':\n      return evaluateDeviceRule(rule.conditions as DeviceConditions, context);\n    case 'LOCATION':\n      return evaluateLocationRule(rule.conditions as LocationConditions, context);\n    default:\n      console.warn(`Unknown rule type: ${rule.rule_type}`);\n      return true; // Unknown rules are ignored\n  }\n}\n\n/**\n * Evaluates TIME-based rules.\n * Checks if current time is within the specified hours/days.\n */\nfunction evaluateTimeRule(\n  conditions: TimeConditions,\n  context: VisitorContext\n): boolean {\n  const { startHour, endHour, days } = conditions;\n  const { currentHour, currentDay } = context;\n\n  // Check day of week if specified\n  if (days && days.length > 0) {\n    if (!days.includes(currentDay)) {\n      return false;\n    }\n  }\n\n  // Handle time ranges (handles overnight ranges like 22:00 - 06:00)\n  if (startHour <= endHour) {\n    // Normal range (e.g., 9 to 17)\n    return currentHour >= startHour && currentHour < endHour;\n  } else {\n    // Overnight range (e.g., 22 to 6)\n    return currentHour >= startHour || currentHour < endHour;\n  }\n}\n\n/**\n * Evaluates DEVICE-based rules.\n * Checks device type and optionally OS.\n */\nfunction evaluateDeviceRule(\n  conditions: DeviceConditions,\n  context: VisitorContext\n): boolean {\n  const { device, os } = conditions;\n\n  // Check device type\n  if (device && device !== context.device) {\n    return false;\n  }\n\n  // Check OS if specified\n  if (os && os !== context.os) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Evaluates LOCATION-based rules.\n * Checks if visitor's country matches.\n */\nfunction evaluateLocationRule(\n  conditions: LocationConditions,\n  context: VisitorContext\n): boolean {\n  const { country, countries } = conditions;\n\n  // If visitor country is unknown, don't apply location rules\n  if (!context.country) {\n    return true; // Show by default if we can't determine location\n  }\n\n  // Single country match\n  if (country) {\n    return context.country.toUpperCase() === country.toUpperCase();\n  }\n\n  // Multiple countries match\n  if (countries && countries.length > 0) {\n    return countries\n      .map((c) => c.toUpperCase())\n      .includes(context.country.toUpperCase());\n  }\n\n  return true;\n}\n\n// ==================== Utility Functions ====================\n\n/**\n * Parses User-Agent string to detect device type.\n */\nexport function detectDevice(userAgent: string): 'mobile' | 'desktop' | 'tablet' {\n  const ua = userAgent.toLowerCase();\n\n  // Check for tablets first (iPads, Android tablets)\n  if (/ipad|android(?!.*mobile)/i.test(ua)) {\n    return 'tablet';\n  }\n\n  // Check for mobile devices\n  if (/mobile|iphone|ipod|android|blackberry|opera mini|iemobile/i.test(ua)) {\n    return 'mobile';\n  }\n\n  return 'desktop';\n}\n\n/**\n * Parses User-Agent string to detect OS.\n */\nexport function detectOS(\n  userAgent: string\n): 'ios' | 'android' | 'windows' | 'macos' | 'linux' | 'unknown' {\n  const ua = userAgent.toLowerCase();\n\n  if (/iphone|ipad|ipod/i.test(ua)) return 'ios';\n  if (/android/i.test(ua)) return 'android';\n  if (/windows/i.test(ua)) return 'windows';\n  if (/macintosh|mac os/i.test(ua)) return 'macos';\n  if (/linux/i.test(ua)) return 'linux';\n\n  return 'unknown';\n}\n\n/**\n * Gets current hour in a specific timezone.\n */\nexport function getCurrentHour(timezone: string = 'UTC'): number {\n  try {\n    const now = new Date();\n    const options: Intl.DateTimeFormatOptions = {\n      hour: 'numeric',\n      hour12: false,\n      timeZone: timezone,\n    };\n    const hour = parseInt(new Intl.DateTimeFormat('en-US', options).format(now));\n    return hour === 24 ? 0 : hour;\n  } catch {\n    return new Date().getHours();\n  }\n}\n\n/**\n * Gets current day of week (0 = Sunday, 6 = Saturday).\n */\nexport function getCurrentDay(timezone: string = 'UTC'): number {\n  try {\n    const now = new Date();\n    const options: Intl.DateTimeFormatOptions = {\n      weekday: 'short',\n      timeZone: timezone,\n    };\n    const dayStr = new Intl.DateTimeFormat('en-US', options).format(now);\n    const dayMap: Record<string, number> = {\n      Sun: 0,\n      Mon: 1,\n      Tue: 2,\n      Wed: 3,\n      Thu: 4,\n      Fri: 5,\n      Sat: 6,\n    };\n    return dayMap[dayStr] ?? new Date().getDay();\n  } catch {\n    return new Date().getDay();\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/lib/visitor-context.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Visitor Context Utilities\n// ============================================\n\nimport { VisitorContext } from '@/types';\nimport { detectDevice, detectOS, getCurrentHour, getCurrentDay } from './rule-engine';\n\n/**\n * Extracts visitor context from Next.js headers.\n */\nexport async function getVisitorContext(\n  headers: Headers\n): Promise<VisitorContext> {\n  // Get User-Agent\n  const userAgent = headers.get('user-agent') || '';\n\n  // Get IP address\n  const ip =\n    headers.get('x-forwarded-for')?.split(',')[0]?.trim() ||\n    headers.get('x-real-ip') ||\n    '127.0.0.1';\n\n  // Detect device and OS from User-Agent\n  const device = detectDevice(userAgent);\n  const os = detectOS(userAgent);\n\n  // Get country from IP (using free geo-ip services)\n  const country = await getCountryFromIP(ip);\n\n  // Get timezone (default to UTC, can be improved with client-side detection)\n  const timezone = headers.get('x-timezone') || 'UTC';\n\n  // Get current time in visitor's timezone\n  const currentHour = getCurrentHour(timezone);\n  const currentDay = getCurrentDay(timezone);\n\n  // Get referrer\n  const referrer = headers.get('referer') || null;\n\n  return {\n    ip,\n    userAgent,\n    device,\n    os,\n    country,\n    currentHour,\n    currentDay,\n    timezone,\n    referrer,\n  };\n}\n\n/**\n * Gets country code from IP address using free geo-ip services.\n * Falls back gracefully if services are unavailable.\n */\nasync function getCountryFromIP(ip: string): Promise<string | null> {\n  // Skip for localhost/private IPs\n  if (isPrivateIP(ip)) {\n    return null;\n  }\n\n  try {\n    // Using ip-api.com (free, no API key required, 45 req/min limit)\n    const response = await fetch(`http://ip-api.com/json/${ip}?fields=countryCode`, {\n      next: { revalidate: 3600 }, // Cache for 1 hour\n    });\n\n    if (response.ok) {\n      const data = await response.json();\n      return data.countryCode || null;\n    }\n  } catch (error) {\n    console.warn('Failed to get country from IP:', error);\n  }\n\n  // Fallback: Try ipapi.co\n  try {\n    const response = await fetch(`https://ipapi.co/${ip}/country/`, {\n      next: { revalidate: 3600 },\n    });\n\n    if (response.ok) {\n      const country = await response.text();\n      return country.trim() || null;\n    }\n  } catch (error) {\n    console.warn('Fallback geo-ip failed:', error);\n  }\n\n  return null;\n}\n\n/**\n * Checks if an IP address is private/local.\n */\nfunction isPrivateIP(ip: string): boolean {\n  // IPv4 private ranges\n  if (\n    ip === '127.0.0.1' ||\n    ip === 'localhost' ||\n    ip.startsWith('10.') ||\n    ip.startsWith('172.16.') ||\n    ip.startsWith('172.17.') ||\n    ip.startsWith('172.18.') ||\n    ip.startsWith('172.19.') ||\n    ip.startsWith('172.20.') ||\n    ip.startsWith('172.21.') ||\n    ip.startsWith('172.22.') ||\n    ip.startsWith('172.23.') ||\n    ip.startsWith('172.24.') ||\n    ip.startsWith('172.25.') ||\n    ip.startsWith('172.26.') ||\n    ip.startsWith('172.27.') ||\n    ip.startsWith('172.28.') ||\n    ip.startsWith('172.29.') ||\n    ip.startsWith('172.30.') ||\n    ip.startsWith('172.31.') ||\n    ip.startsWith('192.168.')\n  ) {\n    return true;\n  }\n\n  // IPv6 localhost\n  if (ip === '::1') {\n    return true;\n  }\n\n  return false;\n}\n"],"names":[],"mappings":"AAAA,+CAA+C;AAC/C,6CAA6C;AAC7C,+CAA+C;;;;;AAG/C;;AAKO,eAAe,kBACpB,OAAgB;IAEhB,iBAAiB;IACjB,MAAM,YAAY,QAAQ,GAAG,CAAC,iBAAiB;IAE/C,iBAAiB;IACjB,MAAM,KACJ,QAAQ,GAAG,CAAC,oBAAoB,MAAM,IAAI,CAAC,EAAE,EAAE,UAC/C,QAAQ,GAAG,CAAC,gBACZ;IAEF,uCAAuC;IACvC,MAAM,SAAS,IAAA,iLAAY,EAAC;IAC5B,MAAM,KAAK,IAAA,6KAAQ,EAAC;IAEpB,mDAAmD;IACnD,MAAM,UAAU,MAAM,iBAAiB;IAEvC,4EAA4E;IAC5E,MAAM,WAAW,QAAQ,GAAG,CAAC,iBAAiB;IAE9C,yCAAyC;IACzC,MAAM,cAAc,IAAA,mLAAc,EAAC;IACnC,MAAM,aAAa,IAAA,kLAAa,EAAC;IAEjC,eAAe;IACf,MAAM,WAAW,QAAQ,GAAG,CAAC,cAAc;IAE3C,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF;AAEA;;;CAGC,GACD,eAAe,iBAAiB,EAAU;IACxC,iCAAiC;IACjC,IAAI,YAAY,KAAK;QACnB,OAAO;IACT;IAEA,IAAI;QACF,iEAAiE;QACjE,MAAM,WAAW,MAAM,MAAM,CAAC,uBAAuB,EAAE,GAAG,mBAAmB,CAAC,EAAE;YAC9E,MAAM;gBAAE,YAAY;YAAK;QAC3B;QAEA,IAAI,SAAS,EAAE,EAAE;YACf,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,OAAO,KAAK,WAAW,IAAI;QAC7B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,kCAAkC;IACjD;IAEA,yBAAyB;IACzB,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,CAAC,iBAAiB,EAAE,GAAG,SAAS,CAAC,EAAE;YAC9D,MAAM;gBAAE,YAAY;YAAK;QAC3B;QAEA,IAAI,SAAS,EAAE,EAAE;YACf,MAAM,UAAU,MAAM,SAAS,IAAI;YACnC,OAAO,QAAQ,IAAI,MAAM;QAC3B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,2BAA2B;IAC1C;IAEA,OAAO;AACT;AAEA;;CAEC,GACD,SAAS,YAAY,EAAU;IAC7B,sBAAsB;IACtB,IACE,OAAO,eACP,OAAO,eACP,GAAG,UAAU,CAAC,UACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,cACd,GAAG,UAAU,CAAC,aACd;QACA,OAAO;IACT;IAEA,iBAAiB;IACjB,IAAI,OAAO,OAAO;QAChB,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 312, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/lib/storage.ts"],"sourcesContent":["import fs from 'fs/promises';\nimport path from 'path';\nimport { Link, LinkWithRules, LinkRule } from '@/types';\n\nconst DATA_DIR = path.join(process.cwd(), 'data');\nconst LINKS_FILE = path.join(DATA_DIR, 'links.json');\nconst RULES_FILE = path.join(DATA_DIR, 'rules.json');\n\n// Initial demo data (Split into Links and Rules)\nconst DEMO_LINKS: Link[] = [\n  {\n    id: 1,\n    hub_id: 1,\n    title: 'ðŸŒ My Website',\n    url: 'https://example.com',\n    icon: null,\n    priority: 100,\n    click_count: 150,\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n    updated_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n  {\n    id: 2,\n    hub_id: 1,\n    title: 'ðŸ’» GitHub',\n    url: 'https://github.com',\n    icon: null,\n    priority: 90,\n    click_count: 120,\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n    updated_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n  {\n    id: 3,\n    hub_id: 1,\n    title: 'ðŸ’¼ LinkedIn',\n    url: 'https://linkedin.com',\n    icon: null,\n    priority: 80,\n    click_count: 100,\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n    updated_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n  {\n    id: 4,\n    hub_id: 1,\n    title: 'ðŸ“… Join Meeting (9AM-5PM)',\n    url: 'https://meet.google.com',\n    icon: null,\n    priority: 70,\n    click_count: 50,\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n    updated_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n];\n\nconst DEMO_RULES: LinkRule[] = [\n  {\n    id: 1,\n    link_id: 4,\n    rule_type: 'TIME',\n    conditions: { startHour: 9, endHour: 17 },\n    action: 'SHOW',\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n];\n\n// Helper to revive dates from JSON\nconst dateReviver = (key: string, value: any) => {\n  if (key === 'created_at' || key === 'updated_at') {\n    return new Date(value);\n  }\n  return value;\n};\n\n// Helper to ensure data directory exists\nasync function ensureDataDir() {\n  try {\n    await fs.access(DATA_DIR);\n  } catch {\n    await fs.mkdir(DATA_DIR, { recursive: true });\n  }\n}\n\n// Basic CRUD for Links\nexport async function readLinks(): Promise<Link[]> {\n  await ensureDataDir();\n  try {\n    const data = await fs.readFile(LINKS_FILE, 'utf-8');\n    return JSON.parse(data, dateReviver);\n  } catch (error) {\n    await writeLinks(DEMO_LINKS);\n    return DEMO_LINKS;\n  }\n}\n\nexport async function writeLinks(links: Link[]): Promise<void> {\n  await ensureDataDir();\n  await fs.writeFile(LINKS_FILE, JSON.stringify(links, null, 2));\n}\n\n// Basic CRUD for Rules\nexport async function readRules(): Promise<LinkRule[]> {\n  await ensureDataDir();\n  try {\n    const data = await fs.readFile(RULES_FILE, 'utf-8');\n    return JSON.parse(data, dateReviver);\n  } catch (error) {\n    await writeRules(DEMO_RULES);\n    return DEMO_RULES;\n  }\n}\n\nexport async function writeRules(rules: LinkRule[]): Promise<void> {\n  await ensureDataDir();\n  await fs.writeFile(RULES_FILE, JSON.stringify(rules, null, 2));\n}\n\n// Joined Data Access\nexport async function getLinksWithRules(): Promise<LinkWithRules[]> {\n  const links = await readLinks();\n  const rules = await readRules();\n  \n  return links.map(link => ({\n    ...link,\n    rules: rules.filter(r => r.link_id === link.id)\n  }));\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAGA,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAC1C,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,UAAU;AACvC,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,UAAU;AAEvC,iDAAiD;AACjD,MAAM,aAAqB;IACzB;QACE,IAAI;QACJ,QAAQ;QACR,OAAO;QACP,KAAK;QACL,MAAM;QACN,UAAU;QACV,aAAa;QACb,WAAW;QACX,YAAY,IAAI,KAAK;QACrB,YAAY,IAAI,KAAK;IACvB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,OAAO;QACP,KAAK;QACL,MAAM;QACN,UAAU;QACV,aAAa;QACb,WAAW;QACX,YAAY,IAAI,KAAK;QACrB,YAAY,IAAI,KAAK;IACvB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,OAAO;QACP,KAAK;QACL,MAAM;QACN,UAAU;QACV,aAAa;QACb,WAAW;QACX,YAAY,IAAI,KAAK;QACrB,YAAY,IAAI,KAAK;IACvB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,OAAO;QACP,KAAK;QACL,MAAM;QACN,UAAU;QACV,aAAa;QACb,WAAW;QACX,YAAY,IAAI,KAAK;QACrB,YAAY,IAAI,KAAK;IACvB;CACD;AAED,MAAM,aAAyB;IAC7B;QACE,IAAI;QACJ,SAAS;QACT,WAAW;QACX,YAAY;YAAE,WAAW;YAAG,SAAS;QAAG;QACxC,QAAQ;QACR,WAAW;QACX,YAAY,IAAI,KAAK;IACvB;CACD;AAED,mCAAmC;AACnC,MAAM,cAAc,CAAC,KAAa;IAChC,IAAI,QAAQ,gBAAgB,QAAQ,cAAc;QAChD,OAAO,IAAI,KAAK;IAClB;IACA,OAAO;AACT;AAEA,yCAAyC;AACzC,eAAe;IACb,IAAI;QACF,MAAM,gIAAE,CAAC,MAAM,CAAC;IAClB,EAAE,OAAM;QACN,MAAM,gIAAE,CAAC,KAAK,CAAC,UAAU;YAAE,WAAW;QAAK;IAC7C;AACF;AAGO,eAAe;IACpB,MAAM;IACN,IAAI;QACF,MAAM,OAAO,MAAM,gIAAE,CAAC,QAAQ,CAAC,YAAY;QAC3C,OAAO,KAAK,KAAK,CAAC,MAAM;IAC1B,EAAE,OAAO,OAAO;QACd,MAAM,WAAW;QACjB,OAAO;IACT;AACF;AAEO,eAAe,WAAW,KAAa;IAC5C,MAAM;IACN,MAAM,gIAAE,CAAC,SAAS,CAAC,YAAY,KAAK,SAAS,CAAC,OAAO,MAAM;AAC7D;AAGO,eAAe;IACpB,MAAM;IACN,IAAI;QACF,MAAM,OAAO,MAAM,gIAAE,CAAC,QAAQ,CAAC,YAAY;QAC3C,OAAO,KAAK,KAAK,CAAC,MAAM;IAC1B,EAAE,OAAO,OAAO;QACd,MAAM,WAAW;QACjB,OAAO;IACT;AACF;AAEO,eAAe,WAAW,KAAiB;IAChD,MAAM;IACN,MAAM,gIAAE,CAAC,SAAS,CAAC,YAAY,KAAK,SAAS,CAAC,OAAO,MAAM;AAC7D;AAGO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM;IAEpB,OAAO,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;YACxB,GAAG,IAAI;YACP,OAAO,MAAM,MAAM,CAAC,CAAA,IAAK,EAAE,OAAO,KAAK,KAAK,EAAE;QAChD,CAAC;AACH"}},
    {"offset": {"line": 453, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/components/LinkButton.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/Documents/GitHub/Advitiya_H/src/components/LinkButton.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Documents/GitHub/Advitiya_H/src/components/LinkButton.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,6SAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA6T,GAC1V,2FACA","ignoreList":[0]}},
    {"offset": {"line": 467, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/components/LinkButton.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/Documents/GitHub/Advitiya_H/src/components/LinkButton.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Documents/GitHub/Advitiya_H/src/components/LinkButton.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,6SAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAyS,GACtU,uEACA","ignoreList":[0]}},
    {"offset": {"line": 481, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 489, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/app/%5Bslug%5D/page.tsx"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Public Hub Page\n// Dynamic route: /[slug]\n// ============================================\n\nimport { headers } from 'next/headers';\nimport { notFound } from 'next/navigation';\nimport { Metadata } from 'next';\nimport { Hub, Link, LinkWithRules } from '@/types';\nimport { evaluateRules } from '@/lib/rule-engine';\nimport { getVisitorContext } from '@/lib/visitor-context';\nimport { getLinksWithRules as fetchLinksFromStorage } from '@/lib/storage';\nimport LinkButton from '@/components/LinkButton';\n\n// Demo data for initial testing (replace with DB queries later)\nconst DEMO_HUB: Hub = {\n  id: 1,\n  user_id: 1,\n  slug: 'demo',\n  title: 'Demo Hub',\n  bio: 'Welcome to my Smart Link Hub! ðŸš€',\n  avatar_url: null,\n  theme_config: {\n    bg: '#000000',\n    accent: '#00FF00',\n    textColor: '#FFFFFF',\n  },\n  is_active: true,\n  created_at: new Date(),\n  updated_at: new Date(),\n};\n\ninterface PageProps {\n  params: Promise<{ slug: string }>;\n}\n\n// Generate metadata for SEO\nexport async function generateMetadata({\n  params,\n}: PageProps): Promise<Metadata> {\n  const { slug } = await params;\n  const hub = await getHub(slug);\n\n  if (!hub) {\n    return {\n      title: 'Hub Not Found',\n    };\n  }\n\n  return {\n    title: `${hub.title} | Smart Link Hub`,\n    description: hub.bio || `Check out ${hub.title}'s links`,\n    openGraph: {\n      title: hub.title,\n      description: hub.bio || undefined,\n      type: 'profile',\n    },\n  };\n}\n\n// Fetch hub data (demo implementation)\nasync function getHub(slug: string): Promise<Hub | null> {\n  // Allow accessing the demo hub via 'demo' or '1'\n  if (slug === 'demo' || slug === '1') {\n    return DEMO_HUB;\n  }\n  return null;\n}\n\n// Fetch links with rules (using file storage)\nasync function getLinksWithRules(hubId: number): Promise<LinkWithRules[]> {\n  try {\n    const allLinks = await fetchLinksFromStorage();\n    return allLinks\n      .filter((l) => l.hub_id === hubId)\n      .sort((a, b) => b.priority - a.priority);\n  } catch (error) {\n    console.error('Error fetching links:', error);\n    return [];\n  }\n}\n\n// Track page view (demo implementation)\nasync function trackPageView(\n  hubId: number,\n  visitorCountry: string | null,\n  visitorDevice: string,\n  userAgent: string,\n  referrer: string | null\n): Promise<void> {\n  // TODO: Replace with actual database insert\n  // console.log('Page View:', { hubId, visitorCountry, ... }); \n}\n\nexport default async function HubPage({ params }: PageProps) {\n  const { slug } = await params;\n\n  // Fetch hub data\n  const hub = await getHub(slug);\n  if (!hub) {\n    notFound();\n  }\n\n  // Get visitor context from headers\n  const headersList = await headers();\n  const context = await getVisitorContext(headersList);\n\n  // Fetch links with their rules\n  const linksWithRules = await getLinksWithRules(hub.id);\n\n  // Apply smart rules to filter links\n  const filteredLinks = evaluateRules(linksWithRules, context);\n\n  // Track page view (async, don't wait)\n  trackPageView(\n    hub.id,\n    context.country,\n    context.device,\n    context.userAgent,\n    context.referrer\n  );\n\n  const { bg, accent, textColor } = hub.theme_config;\n\n  return (\n    <main\n      className=\"min-h-screen flex flex-col items-center px-4 py-12\"\n      style={{ backgroundColor: bg, color: textColor }}\n    >\n      {/* Profile Section */}\n      <div className=\"text-center mb-8 animate-fade-in\">\n        {/* Avatar */}\n        <div\n          className=\"w-24 h-24 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl font-bold\"\n          style={{\n            backgroundColor: `${accent}20`,\n            border: `3px solid ${accent}`,\n            boxShadow: `0 0 20px ${accent}40`,\n          }}\n        >\n          {hub.title.charAt(0).toUpperCase()}\n        </div>\n\n        {/* Title */}\n        <h1\n          className=\"text-2xl font-bold mb-2\"\n          style={{ color: accent }}\n        >\n          {hub.title}\n        </h1>\n\n        {/* Bio */}\n        {hub.bio && (\n          <p className=\"text-gray-400 max-w-md mx-auto\">{hub.bio}</p>\n        )}\n      </div>\n\n      {/* Links Section */}\n      <div className=\"w-full max-w-md space-y-4\">\n        {filteredLinks.length > 0 ? (\n          filteredLinks.map((link, index) => (\n            <LinkButton\n              key={link.id}\n              link={link}\n              accent={accent}\n              index={index}\n            />\n          ))\n        ) : (\n          <p className=\"text-center text-gray-500\">No links available</p>\n        )}\n      </div>\n\n      {/* Footer */}\n      <footer className=\"mt-12 text-center text-gray-600 text-sm\">\n        <p>\n          Powered by{' '}\n          <span style={{ color: accent }} className=\"font-semibold\">\n            Smart Link Hub\n          </span>\n        </p>\n      </footer>\n\n      {/* Debug info (development only) */}\n      {process.env.NODE_ENV === 'development' && (\n        <div className=\"mt-8 p-4 rounded-lg text-xs font-mono\" style={{ backgroundColor: '#111' }}>\n          <p className=\"text-gray-500 mb-2\">Debug Info:</p>\n          <p>Device: {context.device}</p>\n          <p>OS: {context.os}</p>\n          <p>Country: {context.country || 'Unknown'}</p>\n          <p>Hour: {context.currentHour}</p>\n          <p>Day: {context.currentDay}</p>\n          <p>Total Links: {linksWithRules.length}</p>\n          <p>Filtered Links: {filteredLinks.length}</p>\n        </div>\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}