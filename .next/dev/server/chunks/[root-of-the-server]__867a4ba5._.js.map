{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/app/api/analytics/track/route.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Analytics Tracking API\n// POST /api/analytics/track\n// ============================================\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { AnalyticsEvent, EventType } from '@/types';\n\n// In-memory storage for demo (replace with database in production)\nconst events: AnalyticsEvent[] = [];\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { hub_id, link_id, event_type } = body;\n\n    // Validate required fields\n    if (!hub_id || !event_type) {\n      return NextResponse.json(\n        { success: false, error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    // Validate event type\n    if (!['VIEW', 'CLICK'].includes(event_type)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid event type' },\n        { status: 400 }\n      );\n    }\n\n    // Extract visitor info from headers\n    const userAgent = request.headers.get('user-agent') || '';\n    const ip = request.headers.get('x-forwarded-for')?.split(',')[0]?.trim() || \n               request.headers.get('x-real-ip') || \n               'unknown';\n    const referrer = request.headers.get('referer') || null;\n\n    // Detect device from user agent\n    const device = detectDevice(userAgent);\n\n    // Get country (simplified - would use geo-ip in production)\n    const country = await getCountryFromIP(ip);\n\n    // Create event record\n    const event: AnalyticsEvent = {\n      hub_id,\n      link_id: link_id || null,\n      event_type: event_type as EventType,\n      visitor_ip: ip,\n      visitor_country: country,\n      visitor_device: device,\n      visitor_user_agent: userAgent,\n      referrer,\n      created_at: new Date(),\n    };\n\n    // Store event (in-memory for demo)\n    events.push(event);\n\n    // TODO: In production, insert into database\n    // await query(\n    //   `INSERT INTO events (hub_id, link_id, event_type, visitor_ip, visitor_country, visitor_device, visitor_user_agent, referrer)\n    //    VALUES ($1, $2, $3, $4, $5, $6, $7, $8)`,\n    //   [hub_id, link_id, event_type, ip, country, device, userAgent, referrer]\n    // );\n\n    console.log(`[Analytics] ${event_type} recorded for hub ${hub_id}`, {\n      link_id,\n      device,\n      country,\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('[Analytics] Error tracking event:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n// Helper function to detect device\nfunction detectDevice(userAgent: string): string {\n  const ua = userAgent.toLowerCase();\n  if (/ipad|android(?!.*mobile)/i.test(ua)) return 'tablet';\n  if (/mobile|iphone|ipod|android|blackberry|opera mini|iemobile/i.test(ua)) return 'mobile';\n  return 'desktop';\n}\n\n// Helper function to get country from IP\nasync function getCountryFromIP(ip: string): Promise<string | null> {\n  if (ip === 'unknown' || ip === '127.0.0.1' || ip.startsWith('192.168.')) {\n    return null;\n  }\n  \n  try {\n    const response = await fetch(`http://ip-api.com/json/${ip}?fields=countryCode`, {\n      next: { revalidate: 3600 },\n    });\n    if (response.ok) {\n      const data = await response.json();\n      return data.countryCode || null;\n    }\n  } catch {\n    return null;\n  }\n  return null;\n}\n\n// GET endpoint to retrieve events (for debugging)\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const hubId = searchParams.get('hub_id');\n\n  if (!hubId) {\n    return NextResponse.json({ success: true, data: events });\n  }\n\n  const filteredEvents = events.filter((e) => e.hub_id === parseInt(hubId));\n  return NextResponse.json({ success: true, data: filteredEvents });\n}\n"],"names":[],"mappings":"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"}}]
}