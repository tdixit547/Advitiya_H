{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/lib/db.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Database Connection\n// ============================================\n\nimport { Pool, QueryResultRow } from 'pg';\n\n// Create a connection pool\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 2000,\n});\n\n/**\n * Execute a SQL query.\n */\nexport async function query<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n) {\n  const start = Date.now();\n  try {\n    const result = await pool.query<T>(text, params);\n    const duration = Date.now() - start;\n    if (process.env.NODE_ENV === 'development') {\n      console.log('Executed query', { text: text.substring(0, 50), duration, rows: result.rowCount });\n    }\n    return result;\n  } catch (error) {\n    console.error('Database query error:', error);\n    throw error;\n  }\n}\n\n/**\n * Get a single row by query.\n */\nexport async function queryOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T | null> {\n  const result = await query<T>(text, params);\n  return result.rows[0] || null;\n}\n\n/**\n * Get multiple rows by query.\n */\nexport async function queryMany<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T[]> {\n  const result = await query<T>(text, params);\n  return result.rows;\n}\n\n/**\n * Execute an INSERT and return the inserted row.\n */\nexport async function insertOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T> {\n  const result = await query<T>(text, params);\n  return result.rows[0];\n}\n\n/**\n * Health check for database connection.\n */\nexport async function checkConnection(): Promise<boolean> {\n  try {\n    await pool.query('SELECT 1');\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,+CAA+C;AAC/C,uCAAuC;AACvC,+CAA+C;AAE/C;;;;;;AAEA,2BAA2B;AAC3B,MAAM,OAAO,IAAI,0LAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;IAC7E,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAKO,eAAe,MACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,SAAS,MAAM,KAAK,KAAK,CAAI,MAAM;QACzC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,wCAA4C;YAC1C,QAAQ,GAAG,CAAC,kBAAkB;gBAAE,MAAM,KAAK,SAAS,CAAC,GAAG;gBAAK;gBAAU,MAAM,OAAO,QAAQ;YAAC;QAC/F;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAKO,eAAe,SACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE,IAAI;AAC3B;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI;AACpB;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,KAAK,KAAK,CAAC;QACjB,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;uCAEe"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/app/api/shorten/route.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - URL Shortener API\n// POST /api/shorten - Create short URL\n// GET /api/shorten - List short URLs\n// ============================================\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { query, queryMany, queryOne, insertOne } from '@/lib/db';\n\ninterface ShortUrlRow {\n    id: number;\n    short_code: string;\n    original_url: string;\n    created_at: Date;\n    click_count: number;\n    hub_id: number | null;\n}\n\n// Generate random short code\nfunction generateShortCode(length = 6): string {\n    const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    let result = '';\n    for (let i = 0; i < length; i++) {\n        result += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return result;\n}\n\n// POST - Create a short URL\nexport async function POST(request: NextRequest) {\n    try {\n        const body = await request.json();\n        const { url, custom_code, hub_id } = body;\n\n        if (!url) {\n            return NextResponse.json(\n                { success: false, error: 'URL is required' },\n                { status: 400 }\n            );\n        }\n\n        // Validate URL format\n        try {\n            new URL(url);\n        } catch {\n            return NextResponse.json(\n                { success: false, error: 'Invalid URL format' },\n                { status: 400 }\n            );\n        }\n\n        // Generate or use custom short code\n        let shortCode = custom_code || generateShortCode();\n\n        // Check if short code already exists\n        const existing = await queryOne<ShortUrlRow>(\n            `SELECT * FROM short_urls WHERE short_code = $1`,\n            [shortCode]\n        );\n\n        if (existing) {\n            if (custom_code) {\n                return NextResponse.json(\n                    { success: false, error: 'This short code is already taken' },\n                    { status: 409 }\n                );\n            }\n            // Generate a new code if random one exists\n            shortCode = generateShortCode(8);\n        }\n\n        // Insert new short URL\n        const newUrl = await insertOne<ShortUrlRow>(\n            `INSERT INTO short_urls (short_code, original_url, hub_id, click_count)\n       VALUES ($1, $2, $3, 0)\n       RETURNING *`,\n            [shortCode, url, hub_id || null]\n        );\n\n        const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';\n\n        return NextResponse.json({\n            success: true,\n            data: {\n                ...newUrl,\n                short_url: `${baseUrl}/s/${newUrl.short_code}`,\n            },\n        });\n    } catch (error: any) {\n        // Check if it's a \"relation does not exist\" error (table not created)\n        if (error.code === '42P01') {\n            // Create the table\n            await query(`\n        CREATE TABLE IF NOT EXISTS short_urls (\n          id SERIAL PRIMARY KEY,\n          short_code VARCHAR(20) UNIQUE NOT NULL,\n          original_url TEXT NOT NULL,\n          hub_id INT,\n          click_count INT DEFAULT 0,\n          created_at TIMESTAMP DEFAULT NOW()\n        );\n        CREATE INDEX IF NOT EXISTS idx_short_urls_code ON short_urls(short_code);\n      `);\n\n            // Retry the insert\n            return POST(request);\n        }\n\n        console.error('[Shorten API] Error:', error);\n        return NextResponse.json(\n            { success: false, error: 'Failed to create short URL' },\n            { status: 500 }\n        );\n    }\n}\n\n// GET - List all short URLs\nexport async function GET(request: NextRequest) {\n    const { searchParams } = new URL(request.url);\n    const hubId = searchParams.get('hub_id');\n\n    try {\n        let urls: ShortUrlRow[];\n\n        if (hubId) {\n            urls = await queryMany<ShortUrlRow>(\n                `SELECT * FROM short_urls WHERE hub_id = $1 ORDER BY created_at DESC`,\n                [parseInt(hubId)]\n            );\n        } else {\n            urls = await queryMany<ShortUrlRow>(\n                `SELECT * FROM short_urls ORDER BY created_at DESC LIMIT 100`\n            );\n        }\n\n        const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';\n\n        return NextResponse.json({\n            success: true,\n            data: urls.map(u => ({\n                ...u,\n                short_url: `${baseUrl}/s/${u.short_code}`,\n            })),\n        });\n    } catch (error: any) {\n        if (error.code === '42P01') {\n            // Table doesn't exist yet\n            return NextResponse.json({ success: true, data: [] });\n        }\n\n        console.error('[Shorten API] Error fetching URLs:', error);\n        return NextResponse.json(\n            { success: false, error: 'Failed to fetch short URLs' },\n            { status: 500 }\n        );\n    }\n}\n\n// DELETE - Delete a short URL\nexport async function DELETE(request: NextRequest) {\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get('id');\n\n    if (!id) {\n        return NextResponse.json(\n            { success: false, error: 'ID is required' },\n            { status: 400 }\n        );\n    }\n\n    try {\n        const result = await query(\n            `DELETE FROM short_urls WHERE id = $1`,\n            [parseInt(id)]\n        );\n\n        if (result.rowCount === 0) {\n            return NextResponse.json(\n                { success: false, error: 'Short URL not found' },\n                { status: 404 }\n            );\n        }\n\n        return NextResponse.json({\n            success: true,\n            message: 'Short URL deleted',\n        });\n    } catch (error) {\n        console.error('[Shorten API] Error deleting:', error);\n        return NextResponse.json(\n            { success: false, error: 'Failed to delete short URL' },\n            { status: 500 }\n        );\n    }\n}\n"],"names":[],"mappings":"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"}}]
}