{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/lib/storage.ts"],"sourcesContent":["import fs from 'fs/promises';\nimport path from 'path';\nimport os from 'os';\nimport { Link, LinkWithRules, LinkRule } from '@/types';\n\n// Store data in OS temp directory to avoid triggering HMR\nconst DATA_DIR = path.join(os.tmpdir(), 'smart-link-hub-data');\nconst LINKS_FILE = path.join(DATA_DIR, 'links.json');\nconst RULES_FILE = path.join(DATA_DIR, 'rules.json');\n\n// Initial demo data (Split into Links and Rules)\nconst DEMO_LINKS: Link[] = [\n  {\n    id: 1,\n    hub_id: 1,\n    title: 'ðŸŒ My Website',\n    url: 'https://example.com',\n    icon: null,\n    priority: 100,\n    click_count: 150,\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n    updated_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n  {\n    id: 2,\n    hub_id: 1,\n    title: 'ðŸ’» GitHub',\n    url: 'https://github.com',\n    icon: null,\n    priority: 90,\n    click_count: 120,\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n    updated_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n  {\n    id: 3,\n    hub_id: 1,\n    title: 'ðŸ’¼ LinkedIn',\n    url: 'https://linkedin.com',\n    icon: null,\n    priority: 80,\n    click_count: 100,\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n    updated_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n  {\n    id: 4,\n    hub_id: 1,\n    title: 'ðŸ“… Join Meeting (9AM-5PM)',\n    url: 'https://meet.google.com',\n    icon: null,\n    priority: 70,\n    click_count: 50,\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n    updated_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n];\n\nconst DEMO_RULES: LinkRule[] = [\n  {\n    id: 1,\n    link_id: 4,\n    rule_type: 'TIME',\n    conditions: { startHour: 9, endHour: 17 },\n    action: 'SHOW',\n    is_active: true,\n    created_at: new Date('2024-01-01T00:00:00.000Z'),\n  },\n];\n\n// Helper to revive dates from JSON\nconst dateReviver = (key: string, value: any) => {\n  if (key === 'created_at' || key === 'updated_at') {\n    return new Date(value);\n  }\n  return value;\n};\n\n// Helper to ensure data directory exists\nasync function ensureDataDir() {\n  try {\n    await fs.access(DATA_DIR);\n  } catch {\n    await fs.mkdir(DATA_DIR, { recursive: true });\n  }\n}\n\n// Basic CRUD for Links\nexport async function readLinks(): Promise<Link[]> {\n  await ensureDataDir();\n  try {\n    const data = await fs.readFile(LINKS_FILE, 'utf-8');\n    return JSON.parse(data, dateReviver);\n  } catch (error) {\n    await writeLinks(DEMO_LINKS);\n    return DEMO_LINKS;\n  }\n}\n\nexport async function writeLinks(links: Link[]): Promise<void> {\n  await ensureDataDir();\n  await fs.writeFile(LINKS_FILE, JSON.stringify(links, null, 2));\n}\n\n// Basic CRUD for Rules\nexport async function readRules(): Promise<LinkRule[]> {\n  await ensureDataDir();\n  try {\n    const data = await fs.readFile(RULES_FILE, 'utf-8');\n    return JSON.parse(data, dateReviver);\n  } catch (error) {\n    await writeRules(DEMO_RULES);\n    return DEMO_RULES;\n  }\n}\n\nexport async function writeRules(rules: LinkRule[]): Promise<void> {\n  await ensureDataDir();\n  await fs.writeFile(RULES_FILE, JSON.stringify(rules, null, 2));\n}\n\n// Joined Data Access\nexport async function getLinksWithRules(): Promise<LinkWithRules[]> {\n  const links = await readLinks();\n  const rules = await readRules();\n  \n  return links.map(link => ({\n    ...link,\n    rules: rules.filter(r => r.link_id === link.id)\n  }));\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;;;;AAGA,0DAA0D;AAC1D,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,wGAAE,CAAC,MAAM,IAAI;AACxC,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,UAAU;AACvC,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,UAAU;AAEvC,iDAAiD;AACjD,MAAM,aAAqB;IACzB;QACE,IAAI;QACJ,QAAQ;QACR,OAAO;QACP,KAAK;QACL,MAAM;QACN,UAAU;QACV,aAAa;QACb,WAAW;QACX,YAAY,IAAI,KAAK;QACrB,YAAY,IAAI,KAAK;IACvB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,OAAO;QACP,KAAK;QACL,MAAM;QACN,UAAU;QACV,aAAa;QACb,WAAW;QACX,YAAY,IAAI,KAAK;QACrB,YAAY,IAAI,KAAK;IACvB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,OAAO;QACP,KAAK;QACL,MAAM;QACN,UAAU;QACV,aAAa;QACb,WAAW;QACX,YAAY,IAAI,KAAK;QACrB,YAAY,IAAI,KAAK;IACvB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,OAAO;QACP,KAAK;QACL,MAAM;QACN,UAAU;QACV,aAAa;QACb,WAAW;QACX,YAAY,IAAI,KAAK;QACrB,YAAY,IAAI,KAAK;IACvB;CACD;AAED,MAAM,aAAyB;IAC7B;QACE,IAAI;QACJ,SAAS;QACT,WAAW;QACX,YAAY;YAAE,WAAW;YAAG,SAAS;QAAG;QACxC,QAAQ;QACR,WAAW;QACX,YAAY,IAAI,KAAK;IACvB;CACD;AAED,mCAAmC;AACnC,MAAM,cAAc,CAAC,KAAa;IAChC,IAAI,QAAQ,gBAAgB,QAAQ,cAAc;QAChD,OAAO,IAAI,KAAK;IAClB;IACA,OAAO;AACT;AAEA,yCAAyC;AACzC,eAAe;IACb,IAAI;QACF,MAAM,gIAAE,CAAC,MAAM,CAAC;IAClB,EAAE,OAAM;QACN,MAAM,gIAAE,CAAC,KAAK,CAAC,UAAU;YAAE,WAAW;QAAK;IAC7C;AACF;AAGO,eAAe;IACpB,MAAM;IACN,IAAI;QACF,MAAM,OAAO,MAAM,gIAAE,CAAC,QAAQ,CAAC,YAAY;QAC3C,OAAO,KAAK,KAAK,CAAC,MAAM;IAC1B,EAAE,OAAO,OAAO;QACd,MAAM,WAAW;QACjB,OAAO;IACT;AACF;AAEO,eAAe,WAAW,KAAa;IAC5C,MAAM;IACN,MAAM,gIAAE,CAAC,SAAS,CAAC,YAAY,KAAK,SAAS,CAAC,OAAO,MAAM;AAC7D;AAGO,eAAe;IACpB,MAAM;IACN,IAAI;QACF,MAAM,OAAO,MAAM,gIAAE,CAAC,QAAQ,CAAC,YAAY;QAC3C,OAAO,KAAK,KAAK,CAAC,MAAM;IAC1B,EAAE,OAAO,OAAO;QACd,MAAM,WAAW;QACjB,OAAO;IACT;AACF;AAEO,eAAe,WAAW,KAAiB;IAChD,MAAM;IACN,MAAM,gIAAE,CAAC,SAAS,CAAC,YAAY,KAAK,SAAS,CAAC,OAAO,MAAM;AAC7D;AAGO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,MAAM,QAAQ,MAAM;IAEpB,OAAO,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;YACxB,GAAG,IAAI;YACP,OAAO,MAAM,MAAM,CAAC,CAAA,IAAK,EAAE,OAAO,KAAK,KAAK,EAAE;QAChD,CAAC;AACH"}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/app/api/links/route.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Links API\n// CRUD operations for links\n// ============================================\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { Link, CreateLinkInput, UpdateLinkInput } from '@/types';\nimport { readLinks, writeLinks, getLinksWithRules, readRules, writeRules } from '@/lib/storage';\n\n// GET - Fetch all links for a hub\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const hubId = searchParams.get('hub_id');\n\n  if (!hubId) {\n    return NextResponse.json(\n      { success: false, error: 'hub_id is required' },\n      { status: 400 }\n    );\n  }\n\n  const linksWithRules = await getLinksWithRules();\n  const hubLinks = linksWithRules.filter((l) => l.hub_id === parseInt(hubId));\n  \n  return NextResponse.json({\n    success: true,\n    data: hubLinks.sort((a, b) => b.priority - a.priority),\n  });\n}\n\n// POST - Create a new link\nexport async function POST(request: NextRequest) {\n  try {\n    const body: CreateLinkInput = await request.json();\n    const { hub_id, title, url, icon, priority } = body;\n\n    // Validate required fields\n    if (!hub_id || !title || !url) {\n      return NextResponse.json(\n        { success: false, error: 'hub_id, title, and url are required' },\n        { status: 400 }\n      );\n    }\n\n    const links = await readLinks();\n    \n    // Calculate next ID\n    const nextId = links.length > 0 ? Math.max(...links.map(l => l.id)) + 1 : 1;\n\n    const newLink: Link = {\n      id: nextId,\n      hub_id,\n      title,\n      url,\n      icon: icon || null,\n      priority: priority || 0,\n      click_count: 0,\n      is_active: true,\n      created_at: new Date(),\n      updated_at: new Date(),\n    };\n\n    links.push(newLink);\n    await writeLinks(links);\n\n    return NextResponse.json({\n      success: true,\n      data: { ...newLink, rules: [] },\n    });\n  } catch (error) {\n    console.error('[Links API] Error creating link:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to create link' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Update a link\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { id, ...updates }: { id: number } & UpdateLinkInput = body;\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'Link id is required' },\n        { status: 400 }\n      );\n    }\n\n    const links = await readLinks();\n    const linkIndex = links.findIndex((l) => l.id === id);\n    \n    if (linkIndex === -1) {\n      return NextResponse.json(\n        { success: false, error: 'Link not found' },\n        { status: 404 }\n      );\n    }\n\n    // Update the link\n    links[linkIndex] = {\n      ...links[linkIndex],\n      ...updates,\n      updated_at: new Date(),\n    };\n\n    await writeLinks(links);\n\n    // Fetch rules to return complete object\n    const rules = await readRules();\n    const linkRules = rules.filter(r => r.link_id === id);\n\n    return NextResponse.json({\n      success: true,\n      data: { ...links[linkIndex], rules: linkRules },\n    });\n  } catch (error) {\n    console.error('[Links API] Error updating link:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to update link' },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE - Delete a link\nexport async function DELETE(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const id = searchParams.get('id');\n\n  if (!id) {\n    return NextResponse.json(\n      { success: false, error: 'Link id is required' },\n      { status: 400 }\n    );\n  }\n\n  const linkId = parseInt(id);\n  const links = await readLinks();\n  const linkIndex = links.findIndex((l) => l.id === linkId);\n  \n  if (linkIndex === -1) {\n    return NextResponse.json(\n      { success: false, error: 'Link not found' },\n      { status: 404 }\n    );\n  }\n\n  // Remove link\n  links.splice(linkIndex, 1);\n  await writeLinks(links);\n\n  // Cascade delete rules\n  const rules = await readRules();\n  const rulesToKeep = rules.filter(r => r.link_id !== linkId);\n  if (rulesToKeep.length !== rules.length) {\n    await writeRules(rulesToKeep);\n  }\n\n  return NextResponse.json({\n    success: true,\n    message: 'Link deleted successfully',\n  });\n}\n"],"names":[],"mappings":"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"}}]
}