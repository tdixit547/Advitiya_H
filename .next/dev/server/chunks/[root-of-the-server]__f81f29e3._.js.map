{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/lib/db.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Database Connection\n// ============================================\n\nimport { Pool, QueryResultRow } from 'pg';\n\n// Create a connection pool\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 2000,\n});\n\n/**\n * Execute a SQL query.\n */\nexport async function query<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n) {\n  const start = Date.now();\n  try {\n    const result = await pool.query<T>(text, params);\n    const duration = Date.now() - start;\n    if (process.env.NODE_ENV === 'development') {\n      console.log('Executed query', { text: text.substring(0, 50), duration, rows: result.rowCount });\n    }\n    return result;\n  } catch (error) {\n    console.error('Database query error:', error);\n    throw error;\n  }\n}\n\n/**\n * Get a single row by query.\n */\nexport async function queryOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T | null> {\n  const result = await query<T>(text, params);\n  return result.rows[0] || null;\n}\n\n/**\n * Get multiple rows by query.\n */\nexport async function queryMany<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T[]> {\n  const result = await query<T>(text, params);\n  return result.rows;\n}\n\n/**\n * Execute an INSERT and return the inserted row.\n */\nexport async function insertOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T> {\n  const result = await query<T>(text, params);\n  return result.rows[0];\n}\n\n/**\n * Health check for database connection.\n */\nexport async function checkConnection(): Promise<boolean> {\n  try {\n    await pool.query('SELECT 1');\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,+CAA+C;AAC/C,uCAAuC;AACvC,+CAA+C;AAE/C;;;;;;AAEA,2BAA2B;AAC3B,MAAM,OAAO,IAAI,0LAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;IAC7E,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAKO,eAAe,MACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,SAAS,MAAM,KAAK,KAAK,CAAI,MAAM;QACzC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,wCAA4C;YAC1C,QAAQ,GAAG,CAAC,kBAAkB;gBAAE,MAAM,KAAK,SAAS,CAAC,GAAG;gBAAK;gBAAU,MAAM,OAAO,QAAQ;YAAC;QAC/F;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAKO,eAAe,SACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE,IAAI;AAC3B;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI;AACpB;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,KAAK,KAAK,CAAC;QACjB,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;uCAEe"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/app/api/health/db/route.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Database Health Check API\n// GET /api/health/db - PostgreSQL health check\n// ============================================\n\nimport { NextResponse } from 'next/server';\nimport { query, checkConnection } from '@/lib/db';\n\ninterface TableCheck {\n    table_name: string;\n    exists: boolean;\n}\n\ninterface IndexCheck {\n    index_name: string;\n    table_name: string;\n    column_name: string;\n}\n\nexport async function GET() {\n    try {\n        // 1. Check connection\n        const isConnected = await checkConnection();\n        if (!isConnected) {\n            return NextResponse.json({\n                success: false,\n                error: 'Database connection failed',\n                checks: { connection: false },\n            }, { status: 503 });\n        }\n\n        // 2. Check required tables exist\n        const requiredTables = ['users', 'hubs', 'links', 'link_rules', 'events'];\n        const tableResults = await query<{ table_name: string }>(\n            `SELECT table_name FROM information_schema.tables \n       WHERE table_schema = 'public' AND table_type = 'BASE TABLE'`\n        );\n        const existingTables = tableResults.rows.map(r => r.table_name);\n\n        const tableChecks: TableCheck[] = requiredTables.map(t => ({\n            table_name: t,\n            exists: existingTables.includes(t),\n        }));\n\n        const allTablesExist = tableChecks.every(t => t.exists);\n\n        // 3. Check required indexes exist\n        const indexResults = await query<{ indexname: string; tablename: string }>(\n            `SELECT indexname, tablename FROM pg_indexes WHERE schemaname = 'public'`\n        );\n\n        const requiredIndexes = [\n            { table: 'hubs', column: 'slug' },\n            { table: 'links', column: 'hub_id' },\n            { table: 'link_rules', column: 'link_id' },\n            { table: 'events', column: 'hub_id' },\n            { table: 'events', column: 'event_type' },\n        ];\n\n        const existingIndexNames = indexResults.rows.map(r => r.indexname);\n        const indexChecks = requiredIndexes.map(idx => ({\n            index: `idx_${idx.table}_${idx.column}`,\n            table: idx.table,\n            column: idx.column,\n            exists: existingIndexNames.some(name =>\n                name.includes(idx.table) && name.includes(idx.column)\n            ),\n        }));\n\n        // 4. Summary\n        const allHealthy = isConnected && allTablesExist;\n\n        return NextResponse.json({\n            success: allHealthy,\n            database_url: process.env.DATABASE_URL ? 'configured' : 'missing',\n            checks: {\n                connection: isConnected,\n                tables: tableChecks,\n                indexes: indexChecks,\n                all_tables_exist: allTablesExist,\n            },\n            message: allHealthy ? 'Database ready' : 'Database issues detected',\n        }, { status: allHealthy ? 200 : 503 });\n    } catch (error: any) {\n        console.error('[Health] Database check failed:', error);\n        return NextResponse.json({\n            success: false,\n            error: error.message || 'Unknown error',\n            checks: { connection: false },\n        }, { status: 503 });\n    }\n}\n"],"names":[],"mappings":";;;;AAAA,+CAA+C;AAC/C,6CAA6C;AAC7C,+CAA+C;AAC/C,+CAA+C;AAE/C;AACA;;;;;;;AAaO,eAAe;IAClB,IAAI;QACA,sBAAsB;QACtB,MAAM,cAAc,MAAM,IAAA,0KAAe;QACzC,IAAI,CAAC,aAAa;YACd,OAAO,qLAAY,CAAC,IAAI,CAAC;gBACrB,SAAS;gBACT,OAAO;gBACP,QAAQ;oBAAE,YAAY;gBAAM;YAChC,GAAG;gBAAE,QAAQ;YAAI;QACrB;QAEA,iCAAiC;QACjC,MAAM,iBAAiB;YAAC;YAAS;YAAQ;YAAS;YAAc;SAAS;QACzE,MAAM,eAAe,MAAM,IAAA,gKAAK,EAC5B,CAAC;kEACqD,CAAC;QAE3D,MAAM,iBAAiB,aAAa,IAAI,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,UAAU;QAE9D,MAAM,cAA4B,eAAe,GAAG,CAAC,CAAA,IAAK,CAAC;gBACvD,YAAY;gBACZ,QAAQ,eAAe,QAAQ,CAAC;YACpC,CAAC;QAED,MAAM,iBAAiB,YAAY,KAAK,CAAC,CAAA,IAAK,EAAE,MAAM;QAEtD,kCAAkC;QAClC,MAAM,eAAe,MAAM,IAAA,gKAAK,EAC5B,CAAC,uEAAuE,CAAC;QAG7E,MAAM,kBAAkB;YACpB;gBAAE,OAAO;gBAAQ,QAAQ;YAAO;YAChC;gBAAE,OAAO;gBAAS,QAAQ;YAAS;YACnC;gBAAE,OAAO;gBAAc,QAAQ;YAAU;YACzC;gBAAE,OAAO;gBAAU,QAAQ;YAAS;YACpC;gBAAE,OAAO;gBAAU,QAAQ;YAAa;SAC3C;QAED,MAAM,qBAAqB,aAAa,IAAI,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,SAAS;QACjE,MAAM,cAAc,gBAAgB,GAAG,CAAC,CAAA,MAAO,CAAC;gBAC5C,OAAO,CAAC,IAAI,EAAE,IAAI,KAAK,CAAC,CAAC,EAAE,IAAI,MAAM,EAAE;gBACvC,OAAO,IAAI,KAAK;gBAChB,QAAQ,IAAI,MAAM;gBAClB,QAAQ,mBAAmB,IAAI,CAAC,CAAA,OAC5B,KAAK,QAAQ,CAAC,IAAI,KAAK,KAAK,KAAK,QAAQ,CAAC,IAAI,MAAM;YAE5D,CAAC;QAED,aAAa;QACb,MAAM,aAAa,eAAe;QAElC,OAAO,qLAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,cAAc,QAAQ,GAAG,CAAC,YAAY,GAAG,eAAe;YACxD,QAAQ;gBACJ,YAAY;gBACZ,QAAQ;gBACR,SAAS;gBACT,kBAAkB;YACtB;YACA,SAAS,aAAa,mBAAmB;QAC7C,GAAG;YAAE,QAAQ,aAAa,MAAM;QAAI;IACxC,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,qLAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,OAAO,MAAM,OAAO,IAAI;YACxB,QAAQ;gBAAE,YAAY;YAAM;QAChC,GAAG;YAAE,QAAQ;QAAI;IACrB;AACJ"}}]
}