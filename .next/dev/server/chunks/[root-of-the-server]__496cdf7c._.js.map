{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/lib/db.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Database Connection\n// ============================================\n\nimport { Pool, QueryResultRow } from 'pg';\n\n// Create a connection pool\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 2000,\n});\n\n/**\n * Execute a SQL query.\n */\nexport async function query<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n) {\n  const start = Date.now();\n  try {\n    const result = await pool.query<T>(text, params);\n    const duration = Date.now() - start;\n    if (process.env.NODE_ENV === 'development') {\n      console.log('Executed query', { text: text.substring(0, 50), duration, rows: result.rowCount });\n    }\n    return result;\n  } catch (error) {\n    console.error('Database query error:', error);\n    throw error;\n  }\n}\n\n/**\n * Get a single row by query.\n */\nexport async function queryOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T | null> {\n  const result = await query<T>(text, params);\n  return result.rows[0] || null;\n}\n\n/**\n * Get multiple rows by query.\n */\nexport async function queryMany<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T[]> {\n  const result = await query<T>(text, params);\n  return result.rows;\n}\n\n/**\n * Execute an INSERT and return the inserted row.\n */\nexport async function insertOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T> {\n  const result = await query<T>(text, params);\n  return result.rows[0];\n}\n\n/**\n * Health check for database connection.\n */\nexport async function checkConnection(): Promise<boolean> {\n  try {\n    await pool.query('SELECT 1');\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,+CAA+C;AAC/C,uCAAuC;AACvC,+CAA+C;AAE/C;;;;;;AAEA,2BAA2B;AAC3B,MAAM,OAAO,IAAI,0LAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;IAC7E,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAKO,eAAe,MACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,SAAS,MAAM,KAAK,KAAK,CAAI,MAAM;QACzC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,wCAA4C;YAC1C,QAAQ,GAAG,CAAC,kBAAkB;gBAAE,MAAM,KAAK,SAAS,CAAC,GAAG;gBAAK;gBAAU,MAAM,OAAO,QAAQ;YAAC;QAC/F;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAKO,eAAe,SACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE,IAAI;AAC3B;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI;AACpB;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,KAAK,KAAK,CAAC;QACjB,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;uCAEe"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/app/api/links/route.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Links API\n// CRUD operations for links - PostgreSQL version\n// ============================================\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { Link, LinkWithRules, CreateLinkInput, UpdateLinkInput } from '@/types';\nimport { queryMany, queryOne, insertOne, query } from '@/lib/db';\n\n// Database row types\ninterface LinkRow {\n  id: number;\n  hub_id: number;\n  title: string;\n  url: string;\n  icon: string | null;\n  priority: number;\n  click_count: number;\n  is_active: boolean;\n  created_at: Date;\n  updated_at: Date;\n}\n\ninterface RuleRow {\n  id: number;\n  link_id: number;\n  rule_type: string;\n  conditions: object;\n  action: string;\n  is_active: boolean;\n  created_at: Date;\n}\n\n// GET - Fetch all links for a hub (with rules)\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const hubId = searchParams.get('hub_id');\n\n  if (!hubId) {\n    return NextResponse.json(\n      { success: false, error: 'hub_id is required' },\n      { status: 400 }\n    );\n  }\n\n  try {\n    // Fetch links\n    const links = await queryMany<LinkRow>(\n      `SELECT * FROM links WHERE hub_id = $1 ORDER BY priority DESC`,\n      [parseInt(hubId)]\n    );\n\n    // Fetch rules for all links\n    const linkIds = links.map(l => l.id);\n    let rules: RuleRow[] = [];\n\n    if (linkIds.length > 0) {\n      rules = await queryMany<RuleRow>(\n        `SELECT * FROM link_rules WHERE link_id = ANY($1::int[])`,\n        [`{${linkIds.join(',')}}`]\n      );\n    }\n\n    // Combine links with their rules\n    const linksWithRules: LinkWithRules[] = links.map(link => ({\n      ...link,\n      rules: rules\n        .filter(r => r.link_id === link.id)\n        .map(r => ({\n          id: r.id,\n          link_id: r.link_id,\n          rule_type: r.rule_type as 'TIME' | 'DEVICE' | 'LOCATION',\n          conditions: r.conditions,\n          action: r.action as 'SHOW' | 'HIDE',\n          is_active: r.is_active,\n          created_at: r.created_at,\n        })),\n    }));\n\n    return NextResponse.json({\n      success: true,\n      data: linksWithRules,\n    });\n  } catch (error) {\n    console.error('[Links API] Database error:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch links' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST - Create a new link\nexport async function POST(request: NextRequest) {\n  try {\n    const body: CreateLinkInput = await request.json();\n    const { hub_id, title, url, icon, priority } = body;\n\n    // Validate required fields\n    if (!hub_id || !title || !url) {\n      return NextResponse.json(\n        { success: false, error: 'hub_id, title, and url are required' },\n        { status: 400 }\n      );\n    }\n\n    const newLink = await insertOne<LinkRow>(\n      `INSERT INTO links (hub_id, title, url, icon, priority, click_count, is_active)\n       VALUES ($1, $2, $3, $4, $5, 0, true)\n       RETURNING *`,\n      [hub_id, title, url, icon || null, priority || 0]\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: { ...newLink, rules: [] },\n    });\n  } catch (error) {\n    console.error('[Links API] Error creating link:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to create link' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Update a link\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { id, ...updates }: { id: number } & UpdateLinkInput = body;\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'Link id is required' },\n        { status: 400 }\n      );\n    }\n\n    // Build dynamic SET clause\n    const setClauses: string[] = ['updated_at = NOW()'];\n    const values: (string | number | boolean | null)[] = [];\n    let paramIndex = 1;\n\n    if (updates.title !== undefined) {\n      setClauses.push(`title = $${paramIndex++}`);\n      values.push(updates.title);\n    }\n    if (updates.url !== undefined) {\n      setClauses.push(`url = $${paramIndex++}`);\n      values.push(updates.url);\n    }\n    if (updates.icon !== undefined) {\n      setClauses.push(`icon = $${paramIndex++}`);\n      values.push(updates.icon);\n    }\n    if (updates.priority !== undefined) {\n      setClauses.push(`priority = $${paramIndex++}`);\n      values.push(updates.priority);\n    }\n    if (updates.is_active !== undefined) {\n      setClauses.push(`is_active = $${paramIndex++}`);\n      values.push(updates.is_active);\n    }\n\n    values.push(id);\n\n    const updatedLink = await queryOne<LinkRow>(\n      `UPDATE links SET ${setClauses.join(', ')} WHERE id = $${paramIndex} RETURNING *`,\n      values\n    );\n\n    if (!updatedLink) {\n      return NextResponse.json(\n        { success: false, error: 'Link not found' },\n        { status: 404 }\n      );\n    }\n\n    // Fetch rules for this link\n    const rules = await queryMany<RuleRow>(\n      `SELECT * FROM link_rules WHERE link_id = $1`,\n      [id]\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        ...updatedLink,\n        rules: rules.map(r => ({\n          id: r.id,\n          link_id: r.link_id,\n          rule_type: r.rule_type as 'TIME' | 'DEVICE' | 'LOCATION',\n          conditions: r.conditions,\n          action: r.action as 'SHOW' | 'HIDE',\n          is_active: r.is_active,\n          created_at: r.created_at,\n        })),\n      },\n    });\n  } catch (error) {\n    console.error('[Links API] Error updating link:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to update link' },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE - Delete a link\nexport async function DELETE(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const id = searchParams.get('id');\n\n  if (!id) {\n    return NextResponse.json(\n      { success: false, error: 'Link id is required' },\n      { status: 400 }\n    );\n  }\n\n  try {\n    const result = await query(\n      `DELETE FROM links WHERE id = $1`,\n      [parseInt(id)]\n    );\n\n    if (result.rowCount === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Link not found' },\n        { status: 404 }\n      );\n    }\n\n    // Rules are automatically deleted via CASCADE\n\n    return NextResponse.json({\n      success: true,\n      message: 'Link deleted successfully',\n    });\n  } catch (error) {\n    console.error('[Links API] Error deleting link:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete link' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}