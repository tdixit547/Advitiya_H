{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/lib/db.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Database Connection\n// ============================================\n\nimport { Pool, QueryResultRow } from 'pg';\n\n// Create a connection pool\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 2000,\n});\n\n/**\n * Execute a SQL query.\n */\nexport async function query<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n) {\n  const start = Date.now();\n  try {\n    const result = await pool.query<T>(text, params);\n    const duration = Date.now() - start;\n    if (process.env.NODE_ENV === 'development') {\n      console.log('Executed query', { text: text.substring(0, 50), duration, rows: result.rowCount });\n    }\n    return result;\n  } catch (error) {\n    console.error('Database query error:', error);\n    throw error;\n  }\n}\n\n/**\n * Get a single row by query.\n */\nexport async function queryOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T | null> {\n  const result = await query<T>(text, params);\n  return result.rows[0] || null;\n}\n\n/**\n * Get multiple rows by query.\n */\nexport async function queryMany<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T[]> {\n  const result = await query<T>(text, params);\n  return result.rows;\n}\n\n/**\n * Execute an INSERT and return the inserted row.\n */\nexport async function insertOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T> {\n  const result = await query<T>(text, params);\n  return result.rows[0];\n}\n\n/**\n * Health check for database connection.\n */\nexport async function checkConnection(): Promise<boolean> {\n  try {\n    await pool.query('SELECT 1');\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,+CAA+C;AAC/C,uCAAuC;AACvC,+CAA+C;AAE/C;;;;;;AAEA,2BAA2B;AAC3B,MAAM,OAAO,IAAI,0LAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;IAC7E,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAKO,eAAe,MACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,SAAS,MAAM,KAAK,KAAK,CAAI,MAAM;QACzC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,wCAA4C;YAC1C,QAAQ,GAAG,CAAC,kBAAkB;gBAAE,MAAM,KAAK,SAAS,CAAC,GAAG;gBAAK;gBAAU,MAAM,OAAO,QAAQ;YAAC;QAC/F;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAKO,eAAe,SACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE,IAAI;AAC3B;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI;AACpB;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,KAAK,KAAK,CAAC;QACjB,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;uCAEe"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/app/api/rules/route.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Rules API\n// CRUD operations for link rules - PostgreSQL version\n// ============================================\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { LinkRule, CreateRuleInput, RuleType, RuleAction } from '@/types';\nimport { queryMany, queryOne, insertOne, query } from '@/lib/db';\n\n// Database row type\ninterface RuleRow {\n  id: number;\n  link_id: number;\n  rule_type: string;\n  conditions: object;\n  action: string;\n  is_active: boolean;\n  created_at: Date;\n}\n\n// Convert DB row to LinkRule\nfunction toRule(row: RuleRow): LinkRule {\n  return {\n    id: row.id,\n    link_id: row.link_id,\n    rule_type: row.rule_type as RuleType,\n    conditions: row.conditions,\n    action: row.action as RuleAction,\n    is_active: row.is_active,\n    created_at: row.created_at,\n  };\n}\n\n// GET - Fetch all rules for a link\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const linkId = searchParams.get('link_id');\n\n  try {\n    if (!linkId) {\n      // Fetch all rules\n      const rules = await queryMany<RuleRow>(`SELECT * FROM link_rules`);\n      return NextResponse.json({\n        success: true,\n        data: rules.map(toRule),\n      });\n    }\n\n    const rules = await queryMany<RuleRow>(\n      `SELECT * FROM link_rules WHERE link_id = $1`,\n      [parseInt(linkId)]\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: rules.map(toRule),\n    });\n  } catch (error) {\n    console.error('[Rules API] Database error:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch rules' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST - Create a new rule\nexport async function POST(request: NextRequest) {\n  try {\n    const body: CreateRuleInput = await request.json();\n    const { link_id, rule_type, conditions, action } = body;\n\n    // Validate required fields\n    if (!link_id || !rule_type || !conditions) {\n      return NextResponse.json(\n        { success: false, error: 'link_id, rule_type, and conditions are required' },\n        { status: 400 }\n      );\n    }\n\n    // Validate rule type\n    if (!['TIME', 'DEVICE', 'LOCATION'].includes(rule_type)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid rule_type. Must be TIME, DEVICE, or LOCATION' },\n        { status: 400 }\n      );\n    }\n\n    const newRule = await insertOne<RuleRow>(\n      `INSERT INTO link_rules (link_id, rule_type, conditions, action, is_active)\n       VALUES ($1, $2, $3, $4, true)\n       RETURNING *`,\n      [link_id, rule_type, JSON.stringify(conditions), action || 'SHOW']\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: toRule(newRule),\n    });\n  } catch (error) {\n    console.error('[Rules API] Error creating rule:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to create rule' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Update a rule\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { id, ...updates } = body;\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'Rule id is required' },\n        { status: 400 }\n      );\n    }\n\n    // Build dynamic SET clause\n    const setClauses: string[] = [];\n    const values: (string | number | boolean | null)[] = [];\n    let paramIndex = 1;\n\n    if (updates.rule_type !== undefined) {\n      setClauses.push(`rule_type = $${paramIndex++}`);\n      values.push(updates.rule_type);\n    }\n    if (updates.conditions !== undefined) {\n      setClauses.push(`conditions = $${paramIndex++}`);\n      values.push(JSON.stringify(updates.conditions));\n    }\n    if (updates.action !== undefined) {\n      setClauses.push(`action = $${paramIndex++}`);\n      values.push(updates.action);\n    }\n    if (updates.is_active !== undefined) {\n      setClauses.push(`is_active = $${paramIndex++}`);\n      values.push(updates.is_active);\n    }\n\n    if (setClauses.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'No updates provided' },\n        { status: 400 }\n      );\n    }\n\n    values.push(id);\n\n    const updatedRule = await queryOne<RuleRow>(\n      `UPDATE link_rules SET ${setClauses.join(', ')} WHERE id = $${paramIndex} RETURNING *`,\n      values\n    );\n\n    if (!updatedRule) {\n      return NextResponse.json(\n        { success: false, error: 'Rule not found' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: toRule(updatedRule),\n    });\n  } catch (error) {\n    console.error('[Rules API] Error updating rule:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to update rule' },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE - Delete a rule\nexport async function DELETE(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const id = searchParams.get('id');\n\n  if (!id) {\n    return NextResponse.json(\n      { success: false, error: 'Rule id is required' },\n      { status: 400 }\n    );\n  }\n\n  try {\n    const result = await query(\n      `DELETE FROM link_rules WHERE id = $1`,\n      [parseInt(id)]\n    );\n\n    if (result.rowCount === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Rule not found' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Rule deleted successfully',\n    });\n  } catch (error) {\n    console.error('[Rules API] Error deleting rule:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete rule' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}