{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/lib/db.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Database Connection\n// ============================================\n\nimport { Pool, QueryResultRow } from 'pg';\n\n// Create a connection pool\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 2000,\n});\n\n/**\n * Execute a SQL query.\n */\nexport async function query<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n) {\n  const start = Date.now();\n  try {\n    const result = await pool.query<T>(text, params);\n    const duration = Date.now() - start;\n    if (process.env.NODE_ENV === 'development') {\n      console.log('Executed query', { text: text.substring(0, 50), duration, rows: result.rowCount });\n    }\n    return result;\n  } catch (error) {\n    console.error('Database query error:', error);\n    throw error;\n  }\n}\n\n/**\n * Get a single row by query.\n */\nexport async function queryOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T | null> {\n  const result = await query<T>(text, params);\n  return result.rows[0] || null;\n}\n\n/**\n * Get multiple rows by query.\n */\nexport async function queryMany<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T[]> {\n  const result = await query<T>(text, params);\n  return result.rows;\n}\n\n/**\n * Execute an INSERT and return the inserted row.\n */\nexport async function insertOne<T extends QueryResultRow>(\n  text: string,\n  params?: (string | number | boolean | null)[]\n): Promise<T> {\n  const result = await query<T>(text, params);\n  return result.rows[0];\n}\n\n/**\n * Health check for database connection.\n */\nexport async function checkConnection(): Promise<boolean> {\n  try {\n    await pool.query('SELECT 1');\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,+CAA+C;AAC/C,uCAAuC;AACvC,+CAA+C;AAE/C;;;;;;AAEA,2BAA2B;AAC3B,MAAM,OAAO,IAAI,0LAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;IAC7E,KAAK;IACL,mBAAmB;IACnB,yBAAyB;AAC3B;AAKO,eAAe,MACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,SAAS,MAAM,KAAK,KAAK,CAAI,MAAM;QACzC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,wCAA4C;YAC1C,QAAQ,GAAG,CAAC,kBAAkB;gBAAE,MAAM,KAAK,SAAS,CAAC,GAAG;gBAAK;gBAAU,MAAM,OAAO,QAAQ;YAAC;QAC/F;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAKO,eAAe,SACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE,IAAI;AAC3B;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI;AACpB;AAKO,eAAe,UACpB,IAAY,EACZ,MAA6C;IAE7C,MAAM,SAAS,MAAM,MAAS,MAAM;IACpC,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,KAAK,KAAK,CAAC;QACjB,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;uCAEe"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/grover.heer/Documents/GitHub/Advitiya_H/src/app/api/analytics/track/route.ts"],"sourcesContent":["// ============================================\n// SMART LINK HUB - Analytics Tracking API\n// POST /api/analytics/track - PostgreSQL version\n// ============================================\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { AnalyticsEvent, EventType } from '@/types';\nimport { insertOne, queryMany } from '@/lib/db';\n\ninterface EventRow {\n  id: number;\n  hub_id: number;\n  link_id: number | null;\n  event_type: string;\n  visitor_ip: string | null;\n  visitor_country: string | null;\n  visitor_device: string | null;\n  visitor_user_agent: string | null;\n  referrer: string | null;\n  created_at: Date;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { hub_id, link_id, event_type } = body;\n\n    // Validate required fields\n    if (!hub_id || !event_type) {\n      return NextResponse.json(\n        { success: false, error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    // Validate event type\n    if (!['VIEW', 'CLICK'].includes(event_type)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid event type' },\n        { status: 400 }\n      );\n    }\n\n    // Extract visitor info from headers\n    const userAgent = request.headers.get('user-agent') || '';\n    const ip = request.headers.get('x-forwarded-for')?.split(',')[0]?.trim() ||\n      request.headers.get('x-real-ip') ||\n      'unknown';\n    const referrer = request.headers.get('referer') || null;\n\n    // Detect device from user agent\n    const device = detectDevice(userAgent);\n\n    // Get country (simplified - would use geo-ip in production)\n    const country = await getCountryFromIP(ip);\n\n    // Insert event into database\n    await insertOne<EventRow>(\n      `INSERT INTO events (hub_id, link_id, event_type, visitor_ip, visitor_country, visitor_device, visitor_user_agent, referrer)\n       VALUES ($1, $2, $3, $4, $5, $6, $7, $8)\n       RETURNING *`,\n      [hub_id, link_id || null, event_type, ip, country, device, userAgent, referrer]\n    );\n\n    // Also increment click_count on link if this is a click\n    if (event_type === 'CLICK' && link_id) {\n      await insertOne(\n        `UPDATE links SET click_count = click_count + 1 WHERE id = $1 RETURNING *`,\n        [link_id]\n      );\n    }\n\n    console.log(`[Analytics] ${event_type} recorded for hub ${hub_id}`, {\n      link_id,\n      device,\n      country,\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('[Analytics] Error tracking event:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n// Helper function to detect device\nfunction detectDevice(userAgent: string): string {\n  const ua = userAgent.toLowerCase();\n  if (/ipad|android(?!.*mobile)/i.test(ua)) return 'tablet';\n  if (/mobile|iphone|ipod|android|blackberry|opera mini|iemobile/i.test(ua)) return 'mobile';\n  return 'desktop';\n}\n\n// Helper function to get country from IP\nasync function getCountryFromIP(ip: string): Promise<string | null> {\n  if (ip === 'unknown' || ip === '127.0.0.1' || ip.startsWith('192.168.')) {\n    return null;\n  }\n\n  try {\n    const response = await fetch(`http://ip-api.com/json/${ip}?fields=countryCode`, {\n      next: { revalidate: 3600 },\n    });\n    if (response.ok) {\n      const data = await response.json();\n      return data.countryCode || null;\n    }\n  } catch {\n    return null;\n  }\n  return null;\n}\n\n// GET endpoint to retrieve events (for debugging)\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const hubId = searchParams.get('hub_id');\n\n    if (!hubId) {\n      const events = await queryMany<EventRow>(\n        `SELECT * FROM events ORDER BY created_at DESC LIMIT 100`\n      );\n      return NextResponse.json({ success: true, data: events });\n    }\n\n    const events = await queryMany<EventRow>(\n      `SELECT * FROM events WHERE hub_id = $1 ORDER BY created_at DESC LIMIT 100`,\n      [parseInt(hubId)]\n    );\n    return NextResponse.json({ success: true, data: events });\n  } catch (error) {\n    console.error('[Analytics] Error fetching events:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch events' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}