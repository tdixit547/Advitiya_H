{"file":"/Users/grover.heer/Documents/GitHub/Advitiya_H/src/__tests__/DecisionTreeEngine.test.ts","mappings":"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","names":[],"sources":["/Users/grover.heer/Documents/GitHub/Advitiya_H/src/__tests__/DecisionTreeEngine.test.ts"],"sourcesContent":["import { DecisionTreeEngine, IRequestContext } from '../services/DecisionTreeEngine';\nimport { IDecisionNode } from '../models/RuleTree';\n\ndescribe('DecisionTreeEngine', () => {\n    let engine: DecisionTreeEngine;\n\n    beforeEach(() => {\n        engine = new DecisionTreeEngine();\n    });\n\n    describe('parseDevice', () => {\n        it('should identify mobile devices', () => {\n            const mobileUA = 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15';\n            const result = engine.parseDevice(mobileUA);\n            expect(result.type).toBe('mobile');\n        });\n\n        it('should identify desktop devices', () => {\n            const desktopUA = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/91.0';\n            const result = engine.parseDevice(desktopUA);\n            expect(result.type).toBe('desktop');\n        });\n\n        it('should identify tablet devices', () => {\n            const tabletUA = 'Mozilla/5.0 (iPad; CPU OS 14_0 like Mac OS X) AppleWebKit/605.1.15';\n            const result = engine.parseDevice(tabletUA);\n            expect(result.type).toBe('tablet');\n        });\n    });\n\n    describe('traverse', () => {\n        const sampleTree: IDecisionNode = {\n            type: 'device',\n            device_branches: {\n                mobile: {\n                    type: 'location',\n                    country_branches: {\n                        US: {\n                            type: 'leaf',\n                            variant_ids: ['var_us_mobile'],\n                        },\n                        IN: {\n                            type: 'leaf',\n                            variant_ids: ['var_in_mobile'],\n                        },\n                    },\n                    location_default_node: {\n                        type: 'leaf',\n                        variant_ids: ['var_global_mobile'],\n                    },\n                },\n                desktop: {\n                    type: 'location',\n                    country_branches: {\n                        US: {\n                            type: 'leaf',\n                            variant_ids: ['var_us_desktop'],\n                        },\n                    },\n                    location_default_node: {\n                        type: 'leaf',\n                        variant_ids: ['var_global_desktop'],\n                    },\n                },\n                default: {\n                    type: 'leaf',\n                    variant_ids: ['var_other'],\n                },\n            },\n        };\n\n        it('should resolve mobile + US correctly', () => {\n            const context: IRequestContext = {\n                userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)',\n                country: 'US',\n                lat: 0,\n                lon: 0,\n                timestamp: new Date(),\n            };\n\n            const result = engine.traverse(context, sampleTree);\n            expect(result).toEqual(['var_us_mobile']);\n        });\n\n        it('should resolve mobile + IN correctly', () => {\n            const context: IRequestContext = {\n                userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)',\n                country: 'IN',\n                lat: 0,\n                lon: 0,\n                timestamp: new Date(),\n            };\n\n            const result = engine.traverse(context, sampleTree);\n            expect(result).toEqual(['var_in_mobile']);\n        });\n\n        it('should resolve desktop + US correctly', () => {\n            const context: IRequestContext = {\n                userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/91.0',\n                country: 'US',\n                lat: 0,\n                lon: 0,\n                timestamp: new Date(),\n            };\n\n            const result = engine.traverse(context, sampleTree);\n            expect(result).toEqual(['var_us_desktop']);\n        });\n\n        it('should fall back to global for unknown country', () => {\n            const context: IRequestContext = {\n                userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)',\n                country: 'FR',\n                lat: 0,\n                lon: 0,\n                timestamp: new Date(),\n            };\n\n            const result = engine.traverse(context, sampleTree);\n            expect(result).toEqual(['var_global_mobile']);\n        });\n\n        it('should use default device branch for unknown devices', () => {\n            const context: IRequestContext = {\n                userAgent: 'SomeBot/1.0',\n                country: 'US',\n                lat: 0,\n                lon: 0,\n                timestamp: new Date(),\n            };\n\n            const result = engine.traverse(context, sampleTree);\n            expect(result).toEqual(['var_other']);\n        });\n    });\n\n    describe('time window evaluation', () => {\n        const timeTree: IDecisionNode = {\n            type: 'time',\n            time_windows: [\n                {\n                    branch_id: 'business_hours',\n                    recurring: {\n                        days: [1, 2, 3, 4, 5], // Mon-Fri\n                        start_time: '09:00',\n                        end_time: '17:00',\n                        timezone: 'America/New_York',\n                    },\n                    next_node: {\n                        type: 'leaf',\n                        variant_ids: ['var_business'],\n                    },\n                },\n            ],\n            time_default_node: {\n                type: 'leaf',\n                variant_ids: ['var_afterhours'],\n            },\n        };\n\n        it('should match business hours on weekday', () => {\n            // Monday at 10:00 AM Eastern\n            const context: IRequestContext = {\n                userAgent: '',\n                country: 'US',\n                lat: 0,\n                lon: 0,\n                timestamp: new Date('2026-01-26T15:00:00Z'), // 10 AM EST on Monday\n            };\n\n            const result = engine.traverse(context, timeTree);\n            expect(result).toEqual(['var_business']);\n        });\n\n        it('should use default for weekend', () => {\n            // Saturday at 10:00 AM Eastern\n            const context: IRequestContext = {\n                userAgent: '',\n                country: 'US',\n                lat: 0,\n                lon: 0,\n                timestamp: new Date('2026-01-24T15:00:00Z'), // Saturday\n            };\n\n            const result = engine.traverse(context, timeTree);\n            expect(result).toEqual(['var_afterhours']);\n        });\n    });\n});\n"],"version":3}