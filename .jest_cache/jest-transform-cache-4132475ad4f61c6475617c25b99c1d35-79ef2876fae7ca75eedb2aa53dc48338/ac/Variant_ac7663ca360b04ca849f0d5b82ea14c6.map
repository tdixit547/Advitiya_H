{"file":"/Users/grover.heer/Documents/GitHub/Advitiya_H/src/models/Variant.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qDAAsD;AAqBtD,MAAM,yBAAyB,GAAG,IAAI,iBAAM,CAAC;IACzC,SAAS,EAAE,MAAM;IACjB,SAAS,EAAE;QACP,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC;QACxC,UAAU,EAAE,MAAM;QAClB,QAAQ,EAAE,MAAM;QAChB,QAAQ,EAAE,MAAM;KACnB;IACD,QAAQ,EAAE;QACN,KAAK,EAAE,IAAI;QACX,GAAG,EAAE,IAAI;KACZ;CACJ,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC,CAAC;AAEnB,MAAM,uBAAuB,GAAG,IAAI,iBAAM,CAAC;IACvC,YAAY,EAAE,CAAC,MAAM,CAAC;IACtB,SAAS,EAAE,CAAC,MAAM,CAAC;IACnB,YAAY,EAAE,CAAC,yBAAyB,CAAC;CAC5C,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC,CAAC;AAEnB,MAAM,aAAa,GAAG,IAAI,iBAAM,CAAW;IACvC,UAAU,EAAE;QACR,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;QACd,MAAM,EAAE,IAAI;QACZ,KAAK,EAAE,IAAI;KACd;IACD,MAAM,EAAE;QACJ,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;QACd,KAAK,EAAE,IAAI;KACd;IACD,UAAU,EAAE;QACR,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,QAAQ,EAAE;QACN,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,CAAC;KACb;IACD,MAAM,EAAE;QACJ,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,CAAC;QACV,GAAG,EAAE,CAAC;KACT;IACD,OAAO,EAAE;QACL,IAAI,EAAE,OAAO;QACb,OAAO,EAAE,IAAI;KAChB;IACD,UAAU,EAAE;QACR,IAAI,EAAE,uBAAuB;QAC7B,OAAO,EAAE,EAAE;KACd;CACJ,EAAE;IACC,UAAU,EAAE,EAAE,SAAS,EAAE,YAAY,EAAE,SAAS,EAAE,YAAY,EAAE;CACnE,CAAC,CAAC;AAEH,iDAAiD;AACjD,aAAa,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC;AAC/C,aAAa,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AAEpC,QAAA,OAAO,GAAG,kBAAQ,CAAC,KAAK,CAAW,SAAS,EAAE,aAAa,CAAC,CAAC","names":[],"sources":["/Users/grover.heer/Documents/GitHub/Advitiya_H/src/models/Variant.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\nimport { ITimeWindow } from './RuleTree';\n\nexport interface IVariantConditions {\n    device_types?: string[];      // [\"mobile\", \"desktop\"]\n    countries?: string[];          // [\"US\", \"IN\", \"GB\"]\n    time_windows?: ITimeWindow[];\n}\n\nexport interface IVariant extends Document {\n    variant_id: string;\n    hub_id: string;\n    target_url: string;\n    priority: number;              // Higher = better (used for tie-breaking)\n    weight: number;                // For weighted random selection\n    enabled: boolean;\n    conditions: IVariantConditions;\n    created_at: Date;\n    updated_at: Date;\n}\n\nconst TimeWindowConditionSchema = new Schema({\n    branch_id: String,\n    recurring: {\n        days: [{ type: Number, min: 0, max: 6 }],\n        start_time: String,\n        end_time: String,\n        timezone: String,\n    },\n    absolute: {\n        start: Date,\n        end: Date,\n    },\n}, { _id: false });\n\nconst VariantConditionsSchema = new Schema({\n    device_types: [String],\n    countries: [String],\n    time_windows: [TimeWindowConditionSchema],\n}, { _id: false });\n\nconst VariantSchema = new Schema<IVariant>({\n    variant_id: {\n        type: String,\n        required: true,\n        unique: true,\n        index: true\n    },\n    hub_id: {\n        type: String,\n        required: true,\n        index: true\n    },\n    target_url: {\n        type: String,\n        required: true\n    },\n    priority: {\n        type: Number,\n        default: 0\n    },\n    weight: {\n        type: Number,\n        default: 1,\n        min: 0\n    },\n    enabled: {\n        type: Boolean,\n        default: true\n    },\n    conditions: {\n        type: VariantConditionsSchema,\n        default: {}\n    },\n}, {\n    timestamps: { createdAt: 'created_at', updatedAt: 'updated_at' }\n});\n\n// Compound index for efficient hub-based queries\nVariantSchema.index({ hub_id: 1, enabled: 1 });\nVariantSchema.index({ hub_id: 1, priority: -1 });\n\nexport const Variant = mongoose.model<IVariant>('Variant', VariantSchema);\n"],"version":3}