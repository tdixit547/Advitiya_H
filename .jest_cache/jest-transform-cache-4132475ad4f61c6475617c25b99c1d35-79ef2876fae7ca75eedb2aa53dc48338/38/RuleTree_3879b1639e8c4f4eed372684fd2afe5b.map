{"file":"/Users/grover.heer/Documents/GitHub/Advitiya_H/src/models/RuleTree.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qDAAsD;AAgEtD,iCAAiC;AACjC,MAAM,gBAAgB,GAAG,IAAI,iBAAM,CAAC;IAChC,SAAS,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;IAC3C,SAAS,EAAE;QACP,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC;QACxC,UAAU,EAAE,MAAM;QAClB,QAAQ,EAAE,MAAM;QAChB,QAAQ,EAAE,MAAM;KACnB;IACD,QAAQ,EAAE;QACN,KAAK,EAAE,IAAI;QACX,GAAG,EAAE,IAAI;KACZ;CACJ,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC,CAAC;AAEnB,sCAAsC;AACtC,MAAM,kBAAkB,GAAG,IAAI,iBAAM,CAAC;IAClC,IAAI,EAAE;QACF,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,CAAC,QAAQ,EAAE,UAAU,EAAE,MAAM,EAAE,MAAM,CAAC;QAC5C,QAAQ,EAAE,IAAI;KACjB;IACD,eAAe,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,iBAAM,CAAC,KAAK,CAAC,KAAK,EAAE;IACtD,gBAAgB,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,iBAAM,CAAC,KAAK,CAAC,KAAK,EAAE;IACvD,gBAAgB,EAAE;QACd,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,SAAS,CAAC,EAAE;QACzC,WAAW,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;KAC5B;IACD,qBAAqB,EAAE,iBAAM,CAAC,KAAK,CAAC,KAAK;IACzC,eAAe,EAAE;QACb,MAAM,EAAE,CAAC,MAAM,CAAC;QAChB,SAAS,EAAE,MAAM;KACpB;IACD,oBAAoB,EAAE,iBAAM,CAAC,KAAK,CAAC,KAAK;IACxC,qBAAqB,EAAE,iBAAM,CAAC,KAAK,CAAC,KAAK;IACzC,YAAY,EAAE,CAAC,iBAAM,CAAC,KAAK,CAAC,KAAK,CAAC;IAClC,iBAAiB,EAAE,iBAAM,CAAC,KAAK,CAAC,KAAK;IACrC,WAAW,EAAE,CAAC,MAAM,CAAC;CACxB,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC;AAElC,MAAM,cAAc,GAAG,IAAI,iBAAM,CAAY;IACzC,IAAI,EAAE;QACF,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,MAAM,EAAE;QACJ,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;QACd,KAAK,EAAE,IAAI;KACd;IACD,IAAI,EAAE;QACF,IAAI,EAAE,kBAAkB;QACxB,QAAQ,EAAE,IAAI;KACjB;IACD,OAAO,EAAE;QACL,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,CAAC;KACb;CACJ,EAAE;IACC,UAAU,EAAE,EAAE,SAAS,EAAE,YAAY,EAAE,SAAS,EAAE,YAAY,EAAE;CACnE,CAAC,CAAC;AAEH,uCAAuC;AACvC,cAAc,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AAEpC,QAAA,QAAQ,GAAG,kBAAQ,CAAC,KAAK,CAAY,UAAU,EAAE,cAAc,CAAC,CAAC","names":[],"sources":["/Users/grover.heer/Documents/GitHub/Advitiya_H/src/models/RuleTree.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\n\n// Time window for recurring or absolute time-based routing\nexport interface ITimeWindow {\n    branch_id: string;\n    recurring?: {\n        days: number[];        // 0-6 (Sunday-Saturday)\n        start_time: string;    // \"09:00\" in 24h format\n        end_time: string;      // \"17:00\" in 24h format\n        timezone: string;      // IANA timezone e.g., \"Asia/Kolkata\"\n    };\n    absolute?: {\n        start: Date;\n        end: Date;\n    };\n}\n\n// Decision node types\nexport type NodeType = 'device' | 'location' | 'time' | 'leaf';\n\n// Polygon for geo-fencing\nexport interface IGeoPolygon {\n    type: 'Polygon';\n    coordinates: number[][][];\n}\n\n// Radius-based location fallback\nexport interface IRadiusFallback {\n    center: [number, number];  // [lat, lon]\n    radius_km: number;\n}\n\n// Decision node structure (recursive for tree)\nexport interface IDecisionNode {\n    type: NodeType;\n\n    // Device node branches\n    device_branches?: Record<string, IDecisionNode>;  // \"mobile\" | \"desktop\" | \"tablet\" | \"default\"\n\n    // Location node branches\n    country_branches?: Record<string, IDecisionNode>; // Country codes: \"US\", \"IN\", \"GB\", etc.\n    polygon_fallback?: IGeoPolygon;\n    polygon_fallback_node?: IDecisionNode;\n    radius_fallback?: IRadiusFallback;\n    radius_fallback_node?: IDecisionNode;\n    location_default_node?: IDecisionNode;\n\n    // Time node branches\n    time_windows?: Array<ITimeWindow & { next_node: IDecisionNode }>;\n    time_default_node?: IDecisionNode;\n\n    // Leaf node - contains variant IDs\n    variant_ids?: string[];\n}\n\nexport interface IRuleTree extends Document {\n    name: string;\n    hub_id: string;\n    root: IDecisionNode;\n    version: number;\n    created_at: Date;\n    updated_at: Date;\n}\n\n// Nested schema for time windows\nconst TimeWindowSchema = new Schema({\n    branch_id: { type: String, required: true },\n    recurring: {\n        days: [{ type: Number, min: 0, max: 6 }],\n        start_time: String,\n        end_time: String,\n        timezone: String,\n    },\n    absolute: {\n        start: Date,\n        end: Date,\n    },\n}, { _id: false });\n\n// Recursive schema for decision nodes\nconst DecisionNodeSchema = new Schema({\n    type: {\n        type: String,\n        enum: ['device', 'location', 'time', 'leaf'],\n        required: true\n    },\n    device_branches: { type: Map, of: Schema.Types.Mixed },\n    country_branches: { type: Map, of: Schema.Types.Mixed },\n    polygon_fallback: {\n        type: { type: String, enum: ['Polygon'] },\n        coordinates: [[[Number]]],\n    },\n    polygon_fallback_node: Schema.Types.Mixed,\n    radius_fallback: {\n        center: [Number],\n        radius_km: Number,\n    },\n    radius_fallback_node: Schema.Types.Mixed,\n    location_default_node: Schema.Types.Mixed,\n    time_windows: [Schema.Types.Mixed],\n    time_default_node: Schema.Types.Mixed,\n    variant_ids: [String],\n}, { _id: false, strict: false });\n\nconst RuleTreeSchema = new Schema<IRuleTree>({\n    name: {\n        type: String,\n        required: true\n    },\n    hub_id: {\n        type: String,\n        required: true,\n        index: true\n    },\n    root: {\n        type: DecisionNodeSchema,\n        required: true\n    },\n    version: {\n        type: Number,\n        default: 1\n    },\n}, {\n    timestamps: { createdAt: 'created_at', updatedAt: 'updated_at' }\n});\n\n// Compound index for efficient lookups\nRuleTreeSchema.index({ hub_id: 1, version: -1 });\n\nexport const RuleTree = mongoose.model<IRuleTree>('RuleTree', RuleTreeSchema);\n"],"version":3}