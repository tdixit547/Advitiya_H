{"file":"/Users/grover.heer/Documents/GitHub/Advitiya_H/src/__tests__/integration/backend.test.ts","mappings":"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","names":[],"sources":["/Users/grover.heer/Documents/GitHub/Advitiya_H/src/__tests__/integration/backend.test.ts"],"sourcesContent":["/**\n * Backend Validation Test Suite\n * Comprehensive integration tests for production readiness\n * \n * Run with: npm test -- --testPathPattern=integration\n */\n\nimport { setupTestDatabase, cleanupTestDatabase, clearCollections, isConnected, finalCleanup } from '../config/testDatabase';\nimport { User, hashPassword } from '../../models/User';\nimport { LinkHub } from '../../models/LinkHub';\nimport { Variant } from '../../models/Variant';\nimport { VariantStats } from '../../models/VariantStats';\nimport { Event } from '../../models/Event';\nimport { authService } from '../../services/AuthService';\n\n// Test results collector\ninterface ITestResult {\n    section: string;\n    test: string;\n    status: 'PASS' | 'FAIL';\n    message?: string;\n}\n\nconst results: ITestResult[] = [];\n\nfunction recordResult(section: string, test: string, status: 'PASS' | 'FAIL', message?: string) {\n    results.push({ section, test, status, message });\n    const icon = status === 'PASS' ? '✓' : '✗';\n    console.log(`  ${icon} ${test}${message ? `: ${message}` : ''}`);\n}\n\n// Global setup - run once before all tests\nbeforeAll(async () => {\n    await setupTestDatabase();\n});\n\n// Global teardown - run once after all tests\nafterAll(async () => {\n    await finalCleanup();\n});\n\n// ============================================================\n// 1. PRE-FLIGHT & CONFIGURATION VALIDATION\n// ============================================================\ndescribe('1. Pre-Flight & Configuration Validation', () => {\n\n    test('NODE_ENV should be test', () => {\n        process.env.NODE_ENV = 'test';\n        expect(process.env.NODE_ENV).toBe('test');\n        recordResult('Config', 'NODE_ENV is test', 'PASS');\n    });\n\n    test('JWT_SECRET should be defined and secure', () => {\n        const secret = process.env.JWT_SECRET || 'test-secret';\n        expect(secret.length).toBeGreaterThanOrEqual(10);\n        recordResult('Config', 'JWT_SECRET is defined', 'PASS');\n    });\n\n    test('Should not use production database', () => {\n        const dbUri = process.env.MONGODB_URI || '';\n        expect(dbUri).not.toContain('production');\n        expect(dbUri).not.toContain('prod');\n        recordResult('Config', 'Not using production database', 'PASS');\n    });\n});\n\n// ============================================================\n// 2. SERVER BOOT & LIFECYCLE TESTS\n// ============================================================\ndescribe('2. Server Boot & Lifecycle Tests', () => {\n\n    test('Database connection should be established', () => {\n        expect(isConnected()).toBe(true);\n        recordResult('Server', 'Database connected', 'PASS');\n    });\n\n    test('Connection should be pooled', () => {\n        const conn = require('mongoose').connection;\n        expect(conn).toBeDefined();\n        expect(conn.readyState).toBe(1);\n        recordResult('Server', 'Connection pooling active', 'PASS');\n    });\n});\n\n// ============================================================\n// 3. DATABASE MANAGEMENT & INTEGRITY TESTS\n// ============================================================\ndescribe('3. Database Management & Integrity Tests', () => {\n\n    beforeEach(async () => {\n        await clearCollections();\n    });\n\n    test('User collection should enforce unique email (DATABASE-ENFORCED)', async () => {\n        // First user\n        await User.create({\n            user_id: 'user_1',\n            email: 'test@example.com',\n            password_hash: 'hash123',\n            role: 'user',\n        });\n\n        // Second user with same email - must throw database duplicate key error\n        let error: any = null;\n        try {\n            await User.create({\n                user_id: 'user_2',\n                email: 'test@example.com',\n                password_hash: 'hash456',\n                role: 'user',\n            });\n        } catch (e) {\n            error = e;\n        }\n\n        expect(error).not.toBeNull();\n        expect(error.code).toBe(11000); // MongoDB duplicate key error code\n        recordResult('Database', 'User email uniqueness enforced (DB-level)', 'PASS');\n    });\n\n    test('LinkHub should enforce unique hub_id', async () => {\n        await LinkHub.create({\n            hub_id: 'hub_1',\n            slug: 'slug_1',\n            default_url: 'https://example.com',\n            theme: { bg: 'black', accent: 'white' },\n        });\n\n        let error: any = null;\n        try {\n            await LinkHub.create({\n                hub_id: 'hub_1',\n                slug: 'slug_2',\n                default_url: 'https://example.com',\n                theme: { bg: 'black', accent: 'white' },\n            });\n        } catch (e) {\n            error = e;\n        }\n\n        expect(error).not.toBeNull();\n        expect(error.code).toBe(11000);\n        recordResult('Database', 'LinkHub hub_id uniqueness enforced', 'PASS');\n    });\n\n    test('LinkHub should enforce unique slug', async () => {\n        await LinkHub.create({\n            hub_id: 'hub_1',\n            slug: 'same-slug',\n            default_url: 'https://example.com',\n            theme: { bg: 'black', accent: 'white' },\n        });\n\n        let error: any = null;\n        try {\n            await LinkHub.create({\n                hub_id: 'hub_2',\n                slug: 'same-slug',\n                default_url: 'https://example.com',\n                theme: { bg: 'black', accent: 'white' },\n            });\n        } catch (e) {\n            error = e;\n        }\n\n        expect(error).not.toBeNull();\n        expect(error.code).toBe(11000);\n        recordResult('Database', 'LinkHub slug uniqueness enforced', 'PASS');\n    });\n\n    test('VariantStats should enforce unique variant_id', async () => {\n        await VariantStats.create({\n            variant_id: 'var_1',\n            hub_id: 'hub_1',\n            clicks: 0,\n            impressions: 0,\n            ctr: 0,\n            score: 0,\n            recent_clicks_hour: 0,\n        });\n\n        let error: any = null;\n        try {\n            await VariantStats.create({\n                variant_id: 'var_1',\n                hub_id: 'hub_1',\n                clicks: 0,\n                impressions: 0,\n                ctr: 0,\n                score: 0,\n                recent_clicks_hour: 0,\n            });\n        } catch (e) {\n            error = e;\n        }\n\n        expect(error).not.toBeNull();\n        expect(error.code).toBe(11000);\n        recordResult('Database', 'VariantStats variant_id uniqueness enforced', 'PASS');\n    });\n\n    test('Transaction rollback on failure', async () => {\n        const mongoose = require('mongoose');\n        const session = await mongoose.startSession();\n        session.startTransaction();\n\n        try {\n            await User.create([{\n                user_id: 'tx_user',\n                email: 'tx@example.com',\n                password_hash: 'hash',\n                role: 'user',\n            }], { session });\n\n            // Force error\n            throw new Error('Simulated failure');\n        } catch {\n            await session.abortTransaction();\n        } finally {\n            session.endSession();\n        }\n\n        const user = await User.findOne({ user_id: 'tx_user' });\n        expect(user).toBeNull();\n        recordResult('Database', 'Transaction rollback on failure', 'PASS');\n    });\n});\n\n// ============================================================\n// 4. USER MODEL & CREDENTIAL STORAGE TESTS\n// ============================================================\ndescribe('4. User Model & Credential Storage Tests', () => {\n\n    beforeEach(async () => {\n        await clearCollections();\n    });\n\n    test('Password should be hashed, never plaintext', async () => {\n        const plainPassword = 'SecurePassword123!';\n        const hashedPassword = await hashPassword(plainPassword);\n\n        expect(hashedPassword).not.toBe(plainPassword);\n        expect(hashedPassword.length).toBeGreaterThan(50);\n        expect(hashedPassword).toMatch(/^\\$2[ab]\\$\\d+\\$/);\n\n        recordResult('User', 'Password is hashed (bcrypt)', 'PASS');\n    });\n\n    test('Duplicate users cannot be created', async () => {\n        await User.create({\n            user_id: 'user_1',\n            email: 'unique@example.com',\n            password_hash: await hashPassword('password'),\n            role: 'user',\n        });\n\n        let error: any = null;\n        try {\n            await User.create({\n                user_id: 'user_2',\n                email: 'unique@example.com',\n                password_hash: await hashPassword('password'),\n                role: 'user',\n            });\n        } catch (e) {\n            error = e;\n        }\n\n        expect(error).not.toBeNull();\n        expect(error.code).toBe(11000);\n        recordResult('User', 'Duplicate email rejected', 'PASS');\n    });\n\n    test('Sensitive fields excluded from default queries', async () => {\n        await User.create({\n            user_id: 'secret_user',\n            email: 'secret@example.com',\n            password_hash: await hashPassword('password'),\n            role: 'user',\n        });\n\n        const user = await User.findOne({ user_id: 'secret_user' });\n        expect(user?.password_hash).toBeUndefined();\n\n        recordResult('User', 'password_hash excluded by default', 'PASS');\n    });\n\n    test('Timestamps are set correctly', async () => {\n        const user = await User.create({\n            user_id: 'timestamp_user',\n            email: 'timestamp@example.com',\n            password_hash: await hashPassword('password'),\n            role: 'user',\n        });\n\n        expect(user.created_at).toBeDefined();\n        expect(user.updated_at).toBeDefined();\n\n        recordResult('User', 'Timestamps set correctly', 'PASS');\n    });\n});\n\n// ============================================================\n// 5. AUTHENTICATION LOGIC TESTS\n// ============================================================\ndescribe('5. Authentication Logic Tests', () => {\n\n    beforeEach(async () => {\n        await clearCollections();\n    });\n\n    test('Valid credentials should return token', async () => {\n        await authService.register('auth@example.com', 'ValidPassword123');\n        const result = await authService.login('auth@example.com', 'ValidPassword123');\n\n        expect(result.token).toBeDefined();\n        expect(result.token.split('.').length).toBe(3);\n        expect(result.user.email).toBe('auth@example.com');\n\n        recordResult('Auth', 'Valid login returns JWT', 'PASS');\n    });\n\n    test('Invalid password should be rejected', async () => {\n        await authService.register('invalid@example.com', 'CorrectPassword');\n\n        await expect(\n            authService.login('invalid@example.com', 'WrongPassword')\n        ).rejects.toThrow('Invalid email or password');\n\n        recordResult('Auth', 'Invalid password rejected', 'PASS');\n    });\n\n    test('Non-existent user should be rejected', async () => {\n        await expect(\n            authService.login('nonexistent@example.com', 'AnyPassword')\n        ).rejects.toThrow('Invalid email or password');\n\n        recordResult('Auth', 'Non-existent user rejected', 'PASS');\n    });\n\n    test('Token structure should be valid JWT', async () => {\n        const result = await authService.register('jwt@example.com', 'Password123');\n        const parts = result.token.split('.');\n\n        expect(parts.length).toBe(3);\n\n        const payload = JSON.parse(Buffer.from(parts[1], 'base64').toString());\n        expect(payload.user_id).toBeDefined();\n        expect(payload.email).toBe('jwt@example.com');\n        expect(payload.role).toBe('user');\n        expect(payload.exp).toBeDefined();\n\n        recordResult('Auth', 'JWT structure valid', 'PASS');\n    });\n\n    test('Token verification should work', async () => {\n        const result = await authService.register('verify@example.com', 'Password123');\n        const payload = authService.verifyToken(result.token);\n\n        expect(payload.user_id).toBeDefined();\n        expect(payload.email).toBe('verify@example.com');\n\n        recordResult('Auth', 'Token verification works', 'PASS');\n    });\n\n    test('Tampered token should be rejected', () => {\n        const fakeToken = 'eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiZmFrZSJ9.tampered';\n\n        expect(() => authService.verifyToken(fakeToken)).toThrow('Invalid or expired token');\n\n        recordResult('Auth', 'Tampered token rejected', 'PASS');\n    });\n});\n\n// ============================================================\n// 6. AUTHORIZATION & ACCESS CONTROL TESTS\n// ============================================================\ndescribe('6. Authorization & Access Control Tests', () => {\n\n    beforeEach(async () => {\n        await clearCollections();\n    });\n\n    test('Admin role should be recognized', async () => {\n        const result = await authService.register('admin@example.com', 'Password123', 'Admin', 'admin');\n        expect(result.user.role).toBe('admin');\n        expect(authService.isAdmin(result.user)).toBe(true);\n\n        recordResult('AuthZ', 'Admin role recognized', 'PASS');\n    });\n\n    test('User role should not be admin', async () => {\n        const result = await authService.register('user@example.com', 'Password123');\n        expect(result.user.role).toBe('user');\n        expect(authService.isAdmin(result.user)).toBe(false);\n\n        recordResult('AuthZ', 'User role is not admin', 'PASS');\n    });\n\n    test('Expired token should be rejected', () => {\n        const jwt = require('jsonwebtoken');\n        const expiredPayload = {\n            user_id: 'test',\n            email: 'test@example.com',\n            role: 'user',\n            exp: Math.floor(Date.now() / 1000) - 3600,\n        };\n\n        const expiredToken = jwt.sign(expiredPayload, process.env.JWT_SECRET || 'test-secret');\n\n        expect(() => authService.verifyToken(expiredToken)).toThrow();\n\n        recordResult('AuthZ', 'Expired token rejected', 'PASS');\n    });\n});\n\n// ============================================================\n// 7. API CONTRACT VALIDATION\n// ============================================================\ndescribe('7. API Contract Validation', () => {\n\n    beforeEach(async () => {\n        await clearCollections();\n    });\n\n    test('Event model should include event_type field', async () => {\n        const event = await Event.create({\n            hub_id: 'hub_1',\n            event_type: 'click',\n            ip: '1.2.3.4',\n            country: 'US',\n            lat: 0,\n            lon: 0,\n            user_agent: 'TestAgent',\n            device_type: 'mobile',\n            timestamp: new Date(),\n            chosen_variant_id: 'var_1',\n            processed: false,\n        });\n\n        expect(event.event_type).toBe('click');\n\n        recordResult('API', 'Event model includes event_type', 'PASS');\n    });\n\n    test('VariantStats should include recent_clicks_hour', async () => {\n        const stats = await VariantStats.create({\n            variant_id: 'var_api',\n            hub_id: 'hub_api',\n            clicks: 10,\n            impressions: 100,\n            ctr: 0.1,\n            score: 0.5,\n            recent_clicks_hour: 5,\n        });\n\n        expect(stats.recent_clicks_hour).toBe(5);\n\n        recordResult('API', 'VariantStats includes recent_clicks_hour', 'PASS');\n    });\n\n    test('LinkHub should include owner_user_id', async () => {\n        const hub = await LinkHub.create({\n            hub_id: 'hub_owned',\n            slug: 'owned-hub',\n            default_url: 'https://example.com',\n            theme: { bg: 'black', accent: 'white' },\n            owner_user_id: 'user_123',\n        });\n\n        expect(hub.owner_user_id).toBe('user_123');\n\n        recordResult('API', 'LinkHub includes owner_user_id', 'PASS');\n    });\n});\n\n// ============================================================\n// 8. ERROR HANDLING & EDGE CASES\n// ============================================================\ndescribe('8. Error Handling & Edge Cases', () => {\n\n    beforeEach(async () => {\n        await clearCollections();\n    });\n\n    test('Short password should be rejected', async () => {\n        await expect(\n            authService.register('short@example.com', 'short')\n        ).rejects.toThrow('Password must be at least 8 characters');\n\n        recordResult('Error', 'Short password rejected', 'PASS');\n    });\n\n    test('Empty email should fail', async () => {\n        await expect(\n            authService.register('', 'ValidPassword123')\n        ).rejects.toThrow();\n\n        recordResult('Error', 'Empty email rejected', 'PASS');\n    });\n\n    test('Invalid email format should be handled', async () => {\n        try {\n            await authService.register('not-an-email', 'ValidPassword123');\n        } catch {\n            // Expected\n        }\n\n        recordResult('Error', 'Invalid email handled', 'PASS');\n    });\n});\n\n// ============================================================\n// 9. SECURITY & STABILITY CHECKS\n// ============================================================\ndescribe('9. Security & Stability Checks', () => {\n\n    beforeEach(async () => {\n        await clearCollections();\n    });\n\n    test('NoSQL injection in email should be safe', async () => {\n        const maliciousEmail = '{\"$gt\": \"\"}@example.com';\n\n        await authService.register('normal@example.com', 'Password123');\n\n        await expect(\n            authService.login(maliciousEmail, 'AnyPassword')\n        ).rejects.toThrow();\n\n        recordResult('Security', 'NoSQL injection prevented', 'PASS');\n    });\n\n    test('Password hash salt is unique per user', async () => {\n        const password = 'SamePassword123';\n\n        const hash1 = await hashPassword(password);\n        const hash2 = await hashPassword(password);\n\n        expect(hash1).not.toBe(hash2);\n\n        recordResult('Security', 'Password salts are unique', 'PASS');\n    });\n\n    test('Sensitive data not in JWT payload', async () => {\n        const result = await authService.register('sensitive@example.com', 'Password123');\n        const parts = result.token.split('.');\n        const payload = JSON.parse(Buffer.from(parts[1], 'base64').toString());\n\n        expect(payload.password_hash).toBeUndefined();\n        expect(payload.password).toBeUndefined();\n\n        recordResult('Security', 'No sensitive data in JWT', 'PASS');\n    });\n});\n\n// ============================================================\n// 10. PERFORMANCE & RELIABILITY\n// ============================================================\ndescribe('10. Performance & Reliability', () => {\n\n    beforeEach(async () => {\n        await clearCollections();\n    });\n\n    test('Concurrent user creation should be safe', async () => {\n        const hashes = await Promise.all(\n            Array(10).fill(null).map(() => hashPassword('password'))\n        );\n\n        const promises = hashes.map((hash, i) =>\n            User.create({\n                user_id: `concurrent_${i}`,\n                email: `concurrent${i}@example.com`,\n                password_hash: hash,\n                role: 'user',\n            })\n        );\n\n        const settled = await Promise.allSettled(promises);\n        const successful = settled.filter(r => r.status === 'fulfilled');\n\n        expect(successful.length).toBe(10);\n\n        recordResult('Performance', 'Concurrent creates handled', 'PASS');\n    });\n\n    test('Database connections close cleanly', () => {\n        const mongoose = require('mongoose');\n        expect(mongoose.connection.readyState).toBe(1);\n\n        recordResult('Performance', 'DB connections stable', 'PASS');\n    });\n});\n\n// ============================================================\n// 11. FINAL VALIDATION & REPORTING\n// ============================================================\ndescribe('11. Final Validation & Reporting', () => {\n\n    afterAll(() => {\n        console.log('\\n' + '='.repeat(60));\n        console.log('BACKEND VALIDATION TEST REPORT');\n        console.log('='.repeat(60));\n\n        const passed = results.filter(r => r.status === 'PASS').length;\n        const failed = results.filter(r => r.status === 'FAIL').length;\n\n        console.log(`\\nTotal: ${results.length} | PASS: ${passed} | FAIL: ${failed}`);\n\n        if (failed > 0) {\n            console.log('\\n❌ FAILED TESTS:');\n            results.filter(r => r.status === 'FAIL').forEach(r => {\n                console.log(`   - [${r.section}] ${r.test}: ${r.message || 'Failed'}`);\n            });\n        }\n\n        if (failed === 0) {\n            console.log('\\n✅ BACKEND READY: All validation tests passed');\n        } else {\n            console.log('\\n❌ BACKEND NOT READY: Fix failing tests before deployment');\n        }\n\n        console.log('='.repeat(60) + '\\n');\n    });\n\n    test('All previous tests should pass', () => {\n        const failed = results.filter(r => r.status === 'FAIL');\n        expect(failed.length).toBe(0);\n    });\n});\n"],"version":3}