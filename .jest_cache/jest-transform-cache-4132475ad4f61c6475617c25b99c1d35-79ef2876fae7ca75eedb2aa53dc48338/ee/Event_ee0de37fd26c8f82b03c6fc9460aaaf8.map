{"file":"/Users/grover.heer/Documents/GitHub/Advitiya_H/src/models/Event.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qDAAsD;AAuBtD,MAAM,WAAW,GAAG,IAAI,iBAAM,CAAS;IACnC,MAAM,EAAE;QACJ,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;QACd,KAAK,EAAE,IAAI;KACd;IACD,UAAU,EAAE;QACR,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,CAAC,YAAY,EAAE,OAAO,CAAC;QAC7B,QAAQ,EAAE,IAAI;QACd,OAAO,EAAE,OAAO;QAChB,KAAK,EAAE,IAAI;KACd;IACD,EAAE,EAAE;QACA,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,OAAO,EAAE;QACL,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,SAAS;KACrB;IACD,GAAG,EAAE;QACD,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,CAAC;KACb;IACD,GAAG,EAAE;QACD,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,CAAC;KACb;IACD,UAAU,EAAE;QACR,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,EAAE;KACd;IACD,WAAW,EAAE;QACT,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,SAAS;KACrB;IACD,SAAS,EAAE;QACP,IAAI,EAAE,IAAI;QACV,OAAO,EAAE,IAAI,CAAC,GAAG;QACjB,uEAAuE;KAC1E;IACD,iBAAiB,EAAE;QACf,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;QACd,KAAK,EAAE,IAAI;KACd;IACD,SAAS,EAAE;QACP,IAAI,EAAE,OAAO;QACb,OAAO,EAAE,KAAK;KACjB;CACJ,CAAC,CAAC;AAEH,0CAA0C;AAC1C,WAAW,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AAChD,WAAW,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,UAAU,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AAC/D,WAAW,CAAC,KAAK,CAAC,EAAE,iBAAiB,EAAE,CAAC,EAAE,UAAU,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AAC1E,WAAW,CAAC,KAAK,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC;AAElD,+DAA+D;AAC/D,WAAW,CAAC,KAAK,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,EAAE,EAAE,kBAAkB,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;AAElE,QAAA,KAAK,GAAG,kBAAQ,CAAC,KAAK,CAAS,OAAO,EAAE,WAAW,CAAC,CAAC","names":[],"sources":["/Users/grover.heer/Documents/GitHub/Advitiya_H/src/models/Event.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\n\n/**\n * Event types for analytics\n * - impression: Link resolution completed (variant selected)\n * - click: Redirect executed (user followed the link)\n */\nexport type EventType = 'impression' | 'click';\n\nexport interface IEvent extends Document {\n    hub_id: string;\n    event_type: EventType;\n    ip: string;\n    country: string;\n    lat: number;\n    lon: number;\n    user_agent: string;\n    device_type: string;\n    timestamp: Date;\n    chosen_variant_id: string;\n    processed: boolean;\n}\n\nconst EventSchema = new Schema<IEvent>({\n    hub_id: {\n        type: String,\n        required: true,\n        index: true\n    },\n    event_type: {\n        type: String,\n        enum: ['impression', 'click'],\n        required: true,\n        default: 'click',\n        index: true\n    },\n    ip: {\n        type: String,\n        required: true\n    },\n    country: {\n        type: String,\n        default: 'unknown'\n    },\n    lat: {\n        type: Number,\n        default: 0\n    },\n    lon: {\n        type: Number,\n        default: 0\n    },\n    user_agent: {\n        type: String,\n        default: ''\n    },\n    device_type: {\n        type: String,\n        default: 'unknown'\n    },\n    timestamp: {\n        type: Date,\n        default: Date.now,\n        // Note: Don't add index: true here - TTL index below creates the index\n    },\n    chosen_variant_id: {\n        type: String,\n        required: true,\n        index: true\n    },\n    processed: {\n        type: Boolean,\n        default: false\n    },\n});\n\n// Compound indexes for efficient querying\nEventSchema.index({ hub_id: 1, timestamp: -1 });\nEventSchema.index({ hub_id: 1, event_type: 1, timestamp: -1 });\nEventSchema.index({ chosen_variant_id: 1, event_type: 1, timestamp: -1 });\nEventSchema.index({ processed: 1, timestamp: 1 });\n\n// TTL index to auto-delete old events after 90 days (optional)\nEventSchema.index({ timestamp: 1 }, { expireAfterSeconds: 90 * 24 * 60 * 60 });\n\nexport const Event = mongoose.model<IEvent>('Event', EventSchema);\n"],"version":3}